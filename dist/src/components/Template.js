"use strict";
var pug = require('pug');
var objectAssign = require('object-assign');
var Template = (function () {
    function Template() {
    }
    Template.prototype.prepare = function (templateString, filePath, locals, menus) {
        this.ids = [];
        this.assets = [];
        this.menus = [];
        this.compiledTemplate = pug.compile(templateString, {
            filename: filePath,
        });
        this.extractIdsAndAssets(objectAssign({}, locals, { menus: menus }));
        this.extractMenus(locals, menus);
    };
    Template.prototype.extractIdsAndAssets = function (locals) {
        var extraLocals = {
            url: this.mockGenerator(this.ids),
            asset: this.mockGenerator(this.assets),
        };
        this.compiledTemplate(objectAssign({}, locals, extraLocals));
    };
    Template.prototype.extractMenus = function (locals, menus) {
        for (var menu in menus) {
            if (menus.hasOwnProperty(menu)) {
                var cutMenus = objectAssign({}, menus);
                cutMenus[menu] = undefined;
                try {
                    this.compiledTemplate(objectAssign({}, locals, { menus: cutMenus }));
                }
                catch (exception) {
                    this.menus.push(menu);
                }
            }
        }
    };
    Template.prototype.mockGenerator = function (logArray) {
        return function (value) {
            if (value) {
                logArray.push(value);
            }
            return './some/path';
        };
    };
    Template.prototype.generate = function (locals) {
        if (this.compiledTemplate() === undefined) {
            throw new Error('Cannot generate a page from template with nothing prepared!');
        }
        return this.compiledTemplate(locals);
    };
    Template.prototype.getIds = function () {
        return this.ids;
    };
    Template.prototype.getAssets = function () {
        return this.assets;
    };
    Template.prototype.getMenus = function () {
        return this.menus;
    };
    return Template;
}());
exports.Template = Template;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL1RlbXBsYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFRQSxJQUFZLEdBQUcsV0FBTSxLQUFLLENBQUMsQ0FBQTtBQUMzQixJQUFZLFlBQVksV0FBTSxlQUFlLENBQUMsQ0FBQTtBQVE5QztJQUFBO0lBeUdBLENBQUM7SUF0RlUsMEJBQU8sR0FBZCxVQUFlLGNBQXNCLEVBQUUsUUFBZ0IsRUFBRSxNQUFXLEVBQUUsS0FBbUI7UUFDckYsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDZCxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUVoQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUU7WUFDaEQsUUFBUSxFQUFFLFFBQVE7U0FDckIsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUMsWUFBSyxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFNTyxzQ0FBbUIsR0FBM0IsVUFBNEIsTUFBVztRQUNuQyxJQUFJLFdBQVcsR0FBRztZQUNkLEdBQUcsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7WUFDakMsS0FBSyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztTQUN6QyxDQUFDO1FBQ0YsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQU1PLCtCQUFZLEdBQXBCLFVBQXFCLE1BQVcsRUFBRSxLQUFtQjtRQUNqRCxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixJQUFJLFFBQVEsR0FBRyxZQUFZLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUN2QyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsU0FBUyxDQUFDO2dCQUMzQixJQUFJLENBQUM7b0JBQ0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUMsS0FBSyxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQztnQkFDdkUsQ0FBRTtnQkFBQSxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUNqQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDMUIsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQU1PLGdDQUFhLEdBQXJCLFVBQXNCLFFBQWtCO1FBQ3BDLE1BQU0sQ0FBQyxVQUFDLEtBQWM7WUFDbEIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDUixRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3pCLENBQUM7WUFDRCxNQUFNLENBQUMsYUFBYSxDQUFDO1FBQ3pCLENBQUMsQ0FBQztJQUNOLENBQUM7SUFNTSwyQkFBUSxHQUFmLFVBQWdCLE1BQVk7UUFDeEIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN4QyxNQUFNLElBQUksS0FBSyxDQUFDLDZEQUE2RCxDQUFDLENBQUM7UUFDbkYsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUtNLHlCQUFNLEdBQWI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNwQixDQUFDO0lBS00sNEJBQVMsR0FBaEI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBS00sMkJBQVEsR0FBZjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFDTCxlQUFDO0FBQUQsQ0F6R0EsQUF5R0MsSUFBQTtBQXpHWSxnQkFBUSxXQXlHcEIsQ0FBQSIsImZpbGUiOiJzcmMvY29tcG9uZW50cy9UZW1wbGF0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQWxsIGNvZGUgcmVsYXRlZCB0byB0aGUgcmVwcmVzZXRudGF0aW9uIG9mIGEgdGVtcGxhdGUgZmlsZVxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0ICogYXMgcHVnIGZyb20gJ3B1Zyc7XG5pbXBvcnQgKiBhcyBvYmplY3RBc3NpZ24gZnJvbSAnb2JqZWN0LWFzc2lnbic7XG5pbXBvcnQge0lTaXRlTWVudU1hcH0gZnJvbSAnLi9NZW51JztcblxuLyoqXG4gKiBAY2xhc3MgV3JhcHBlciBhcm91bmQgYSBzcGVjaWZpYyB0ZW1wbGF0aW5nIGVuZ2luZSwgY3VycmVudGx5IG9ubHkgUHVnXG4gKiBAc2luY2UgMC4yLjBcbiAqXG4gKi9cbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZSB7XG4gICAgLyoqXG4gICAgICogQ29tcGlsZWQgUHVnIHRlbXBsYXRlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBjb21waWxlZFRlbXBsYXRlOiAobG9jYWxzPzogYW55KSA9PiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBBcnJheXMgb2YgSURzLCBhc3NldHMgYW5kIG1lbnVzIHJlZmVyZW5jZWQgaW4gdGhlIHRlbXBsYXRlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBpZHM6IHN0cmluZ1tdO1xuICAgIHByaXZhdGUgYXNzZXRzOiBzdHJpbmdbXTtcbiAgICBwcml2YXRlIG1lbnVzOiBzdHJpbmdbXTtcblxuICAgIC8qKlxuICAgICAqIEV4dHJhY3RzIGxpc3Qgb2YgcmVmZXJlbmNlZCBJRHMsIGFzc2V0cyBhbmQgbWVudXMgZnJvbSB0aGUgdGVtcGxhdGUgYWZ0ZXIgY29tcGlsaW5nIGl0XG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHByZXBhcmUodGVtcGxhdGVTdHJpbmc6IHN0cmluZywgZmlsZVBhdGg6IHN0cmluZywgbG9jYWxzOiBhbnksIG1lbnVzOiBJU2l0ZU1lbnVNYXApIHtcbiAgICAgICAgdGhpcy5pZHMgPSBbXTtcbiAgICAgICAgdGhpcy5hc3NldHMgPSBbXTtcbiAgICAgICAgdGhpcy5tZW51cyA9IFtdO1xuXG4gICAgICAgIHRoaXMuY29tcGlsZWRUZW1wbGF0ZSA9IHB1Zy5jb21waWxlKHRlbXBsYXRlU3RyaW5nLCB7XG4gICAgICAgICAgICBmaWxlbmFtZTogZmlsZVBhdGgsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmV4dHJhY3RJZHNBbmRBc3NldHMob2JqZWN0QXNzaWduKHt9LCBsb2NhbHMsIHttZW51c30pKTtcbiAgICAgICAgdGhpcy5leHRyYWN0TWVudXMobG9jYWxzLCBtZW51cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdCBJRHMgYW5kIGFzc2V0cyBmcm9tIGEgY29tcGlsZWQgdGVtcGxhdGUgdXNpbmcgbW9jayBnZW5lcmF0b3JzXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBleHRyYWN0SWRzQW5kQXNzZXRzKGxvY2FsczogYW55KSB7XG4gICAgICAgIGxldCBleHRyYUxvY2FscyA9IHtcbiAgICAgICAgICAgIHVybDogdGhpcy5tb2NrR2VuZXJhdG9yKHRoaXMuaWRzKSxcbiAgICAgICAgICAgIGFzc2V0OiB0aGlzLm1vY2tHZW5lcmF0b3IodGhpcy5hc3NldHMpLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNvbXBpbGVkVGVtcGxhdGUob2JqZWN0QXNzaWduKHt9LCBsb2NhbHMsIGV4dHJhTG9jYWxzKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdHMgbWVudXMgcmVmZXJlbmNlZCBpbiB0aGUgY29tcGlsZWQgdGVtcGxhdGVcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIGV4dHJhY3RNZW51cyhsb2NhbHM6IGFueSwgbWVudXM6IElTaXRlTWVudU1hcCkge1xuICAgICAgICBmb3IgKGxldCBtZW51IGluIG1lbnVzKSB7XG4gICAgICAgICAgICBpZiAobWVudXMuaGFzT3duUHJvcGVydHkobWVudSkpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3V0TWVudXMgPSBvYmplY3RBc3NpZ24oe30sIG1lbnVzKTtcbiAgICAgICAgICAgICAgICBjdXRNZW51c1ttZW51XSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXBpbGVkVGVtcGxhdGUob2JqZWN0QXNzaWduKHt9LCBsb2NhbHMsIHttZW51czogY3V0TWVudXN9KSk7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubWVudXMucHVzaChtZW51KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgbW9jayBzdHJpbmcgZ2VuZXJhdG9yIHRoYXQgbG9ncyBjYWxsIHBhcmFtZXRlcnMgaW50byBhbiBhcnJheVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgbW9ja0dlbmVyYXRvcihsb2dBcnJheTogc3RyaW5nW10pOiAodmFsdWU/OiBzdHJpbmcpID0+IHN0cmluZyB7XG4gICAgICAgIHJldHVybiAodmFsdWU/OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGxvZ0FycmF5LnB1c2godmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICcuL3NvbWUvcGF0aCc7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGVzIGEgSFRNTCBwYWdlIGZyb20gdGhlIHRlbXBsYXRlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGdlbmVyYXRlKGxvY2Fscz86IGFueSk6IHN0cmluZyB7XG4gICAgICAgIGlmICh0aGlzLmNvbXBpbGVkVGVtcGxhdGUoKSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBnZW5lcmF0ZSBhIHBhZ2UgZnJvbSB0ZW1wbGF0ZSB3aXRoIG5vdGhpbmcgcHJlcGFyZWQhJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcGlsZWRUZW1wbGF0ZShsb2NhbHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRJZHMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5pZHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGdldEFzc2V0cygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFzc2V0cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0TWVudXMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5tZW51cztcbiAgICB9XG59XG4iXX0=
