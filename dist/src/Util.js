"use strict";
var yaml = require("js-yaml");
var marked = require("marked");
var fs = require("fs");
var path = require("path");
var colors = require("colors");
var Util = (function () {
    function Util() {
    }
    Util.getPackageInfo = function () {
        if (this.packageInfoCache === undefined) {
            this.packageInfoCache = require('../../package.json');
        }
        return this.packageInfoCache;
    };
    Util.logWithPrefix = function (prefix, object) {
        console.log(prefix + ' ' + object.toString());
    };
    Util.log = function (object) {
        Util.logWithPrefix(colors.cyan('[Blitz LOG]'), object);
    };
    Util.warn = function (object) {
        Util.logWithPrefix(colors.yellow('[Blitz WRN]'), object);
    };
    Util.error = function (object) {
        Util.logWithPrefix(colors.red('[Blitz ERR]'), object);
    };
    Util.stackTrace = function (object) {
        console.log(object);
    };
    Util.debug = function (object) {
        if (global.debug) {
            Util.logWithPrefix(colors.yellow('[Blitz DEBUG]'), object);
        }
    };
    Util.parseYaml = function (yamlString) {
        Util.debug('Parsing  YAML...');
        yamlString = yamlString.replace(/^\s+|\s+$/g, '');
        if (yamlString === '') {
            return {};
        }
        return yaml.safeLoad(yamlString);
    };
    Util.parseMarkdown = function (markdown) {
        return marked(markdown);
    };
    Util.pathExists = function (path) {
        try {
            fs.accessSync(path);
            return true;
        }
        catch (e) {
            return false;
        }
    };
    Util.writeFileFromArray = function (basePath, array, contents) {
        if (array.length === 0) {
            Util.error('Cannot write file from an empty array!');
            console.trace();
            return false;
        }
        var currentPath = basePath;
        var count = array.length;
        for (var i = 0; i < count - 1; i++) {
            currentPath = path.join(currentPath, array[i]);
            if (!Util.createDirectory(currentPath)) {
                return false;
            }
        }
        try {
            fs.writeFileSync(path.join(currentPath, array[count - 1]), contents);
        }
        catch (e) {
            Util.error('Error writing to `' + basePath + '`!');
            Util.stackTrace(e);
            return false;
        }
        return true;
    };
    Util.getFileContents = function (filePath) {
        Util.debug('Reading contents of `' + filePath + '`...');
        return fs.readFileSync(filePath, 'utf8');
    };
    Util.createDirectory = function (directoryPath) {
        try {
            if (!fs.existsSync(directoryPath)) {
                fs.mkdirSync(directoryPath);
            }
            return true;
        }
        catch (e) {
            Util.error('Error creating directory `' + directoryPath + '`.');
            Util.stackTrace(e);
            return false;
        }
    };
    Util.removeDirectory = function (directoryPath) {
        var files = [];
        try {
            if (fs.existsSync(directoryPath)) {
                files = fs.readdirSync(directoryPath);
                files.forEach(function (file) {
                    var currentPath = path.join(directoryPath, file);
                    if (fs.lstatSync(currentPath).isDirectory()) {
                        Util.removeDirectory(currentPath);
                    }
                    else {
                        fs.unlinkSync(currentPath);
                    }
                });
                fs.rmdirSync(directoryPath);
            }
        }
        catch (e) {
            Util.error('Could not recursively remove a directory!');
            Util.stackTrace(e);
            return false;
        }
        return true;
    };
    Util.stripSlashes = function (stringWithSlashes) {
        stringWithSlashes = stringWithSlashes.replace(new RegExp('^/*'), '');
        stringWithSlashes = stringWithSlashes.replace(new RegExp('/*$'), '');
        return stringWithSlashes;
    };
    Util.getUriComponents = function (uri) {
        var strippedUri = Util.stripSlashes(uri);
        var components = strippedUri.split('/');
        if (components[0] === '') {
            return [];
        }
        return components;
    };
    Util.extractFileName = function (filePath) {
        return path.basename(filePath).replace(/\.[^/.]+$/, '');
    };
    Util.generateRandomString = function (length) {
        var characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var result = '';
        for (var i = length; i > 0; --i) {
            result += characters[Math.floor(Math.random() * characters.length)];
        }
        return result;
    };
    Util.isEmpty = function (object) {
        return Object.keys(object).length === 0;
    };
    Util.isString = function (object) {
        return typeof object === 'string';
    };
    return Util;
}());
exports.Util = Util;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFNYSx5QkFBb0IsR0FBbEMsVUFBbUMsTUFBYztRQUM3QyxJQUFJLFVBQVUsR0FBRyxnRUFBZ0UsQ0FBQztRQUNsRixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUM5QixNQUFNLElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3hFLENBQUM7UUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFNYSxZQUFPLEdBQXJCLFVBQXNCLE1BQVc7UUFDN0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBTWEsYUFBUSxHQUF0QixVQUF1QixNQUFXO1FBQzlCLE1BQU0sQ0FBQyxPQUFPLE1BQU0sS0FBSyxRQUFRLENBQUM7SUFDdEMsQ0FBQztJQUNMLFdBQUM7QUFBRCxDQTdQQSxBQTZQQyxJQUFBO0FBN1BZLG9CQUFJIiwiZmlsZSI6InNyYy9VdGlsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBVdGlsaXR5IGNsYXNzZXMgYW5kIGludGVyZmFjZXMgZm9yIEJsaXR6LlxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMC4xXG4gKi9cblxuaW1wb3J0ICogYXMgeWFtbCBmcm9tICdqcy15YW1sJztcbmltcG9ydCAqIGFzIG1hcmtlZCBmcm9tICdtYXJrZWQnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGNvbG9ycyBmcm9tICdjb2xvcnMnO1xuXG4vKipcbiAqIEBjbGFzcyBVdGlsaXR5IGNsYXNzIGZvciBCbGl0ei5cbiAqIEBzaW5jZSAwLjAuMVxuICovXG5leHBvcnQgY2xhc3MgVXRpbCB7XG4gICAgLyoqXG4gICAgICogQ2FjaGUgZm9yIHBhY2thZ2UgaW5mb1xuICAgICAqIEBzaW5jZSAwLjEuM1xuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIHBhY2thZ2VJbmZvQ2FjaGU6IGFueTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgcGFja2FnZSBpbmZvIGZyb20gYHBhY2thZ2UuanNvbmBcbiAgICAgKiBAc2luY2UgMC4xLjNcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGdldFBhY2thZ2VJbmZvKCkge1xuICAgICAgICBpZiAodGhpcy5wYWNrYWdlSW5mb0NhY2hlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucGFja2FnZUluZm9DYWNoZSA9IHJlcXVpcmUoJy4uLy4uL3BhY2thZ2UuanNvbicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnBhY2thZ2VJbmZvQ2FjaGU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9ncyBhbiBvYmplY3QgdG8gY29uc29sZSBwcmVmaXhpbmcgaXQgd2l0aCB0aGUgc3BlY2lmaWVkIHN0cmluZy5cbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgTG9nZ2VyLmxvZ1dpdGhQcmVmaXgoKSBpbnN0ZWFkXG4gICAgICogQHNpbmNlIDAuMC4xXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBsb2dXaXRoUHJlZml4KHByZWZpeDogc3RyaW5nLCBvYmplY3Q6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhwcmVmaXggKyAnICcgKyBvYmplY3QudG9TdHJpbmcoKSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9ncyBkYXRhIGludG8gY29uc29sZVxuICAgICAqIEBkZXByZWNhdGVkIFVzZSBMb2dnZXIubG9nKCkgaW5zdGVhZFxuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbG9nKG9iamVjdDogYW55KSB7XG4gICAgICAgIFV0aWwubG9nV2l0aFByZWZpeChjb2xvcnMuY3lhbignW0JsaXR6IExPR10nKSwgb2JqZWN0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMb2dzIGEgd2FybmluZyBpbnRvIGNvbnNvbGVcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgTG9nZ2VyLndhcm4oKSBpbnN0ZWFkXG4gICAgICogQHNpbmNlIDAuMS4zXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyB3YXJuKG9iamVjdDogYW55KSB7XG4gICAgICAgIFV0aWwubG9nV2l0aFByZWZpeChjb2xvcnMueWVsbG93KCdbQmxpdHogV1JOXScpLCBvYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvZ3MgZXJyb3IgZGF0YSBpbnRvIGNvbnNvbGVcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgTG9nZ2VyLmVycm9yKCkgaW5zdGVhZFxuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZXJyb3Iob2JqZWN0OiBhbnkpIHtcbiAgICAgICAgVXRpbC5sb2dXaXRoUHJlZml4KGNvbG9ycy5yZWQoJ1tCbGl0eiBFUlJdJyksIG9iamVjdCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJpbnQgb3V0IHRoZSBlcnJvciBhcyBpc1xuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc3RhY2tUcmFjZShvYmplY3Q6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhvYmplY3QpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExvZ3MgZGVidWcgZGF0YSBpbnRvIGNvbnNvbGVcbiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgTG9nZ2VyLmRlYnVnKCkgaW5zdGVhZFxuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZGVidWcob2JqZWN0OiBhbnkpIHtcbiAgICAgICAgaWYgKGdsb2JhbC5kZWJ1Zykge1xuICAgICAgICAgICAgVXRpbC5sb2dXaXRoUHJlZml4KGNvbG9ycy55ZWxsb3coJ1tCbGl0eiBERUJVR10nKSwgb2JqZWN0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByb2R1Y2VzIGFuIG9iamVjdCBmcm9tIFlBTUwgc3RyaW5nIGlmIHBvc3NpYmxlLCByZXR1cm5zIHVuZGVmaW5lZCBvdGhlcndpc2UuXG4gICAgICogQHNpbmNlIDAuMS4yIFJldHVybnMgZW1wdHkgb2JqZWN0IGZvciBmaWxlcyB0aGF0IG9ubHkgaGF2ZSB3aGl0ZXNwYWNlXG4gICAgICogQHNpbmNlIDAuMS4yIFJlbW92ZWQgdHJ5L2NhdGNoIGJsb2NrXG4gICAgICogQHNpbmNlIDAuMC4xXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBwYXJzZVlhbWwoeWFtbFN0cmluZzogc3RyaW5nKTogYW55IHtcbiAgICAgICAgVXRpbC5kZWJ1ZygnUGFyc2luZyAgWUFNTC4uLicpO1xuICAgICAgICB5YW1sU3RyaW5nID0geWFtbFN0cmluZy5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgICAgIGlmICh5YW1sU3RyaW5nID09PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB5YW1sLnNhZmVMb2FkKHlhbWxTdHJpbmcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIE1hcmtkb3duIGludG8gSFRNTFxuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcGFyc2VNYXJrZG93bihtYXJrZG93bjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIG1hcmtlZChtYXJrZG93bik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHRoYXQgYSBkaXJlY3Rvcnkgb3IgYSBmaWxlIGV4aXN0c1xuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcGF0aEV4aXN0cyhwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFRPRE86IEFkZCBtb2RlIHRvIGBhY2Nlc3NTeW5jKClgXG4gICAgICAgICAgICBmcy5hY2Nlc3NTeW5jKHBhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgZm9sZGVycyB3aXRoIG5hbWVzIGlkZW50aWNhbCB0byB0aGF0IGluIHRoZSBhcnJheSwgYW5kIHVzZXMgdGhlIGxhc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkgYXMgdGhlIGZpbGVcbiAgICAgKiBuYW1lIHRvIHdoaWNoIHRoZSBjb250ZW50cyB3aWxsIGJlIHdyaXR0ZW4uXG4gICAgICogQHNpbmNlIDAuMC4xXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyB3cml0ZUZpbGVGcm9tQXJyYXkoYmFzZVBhdGg6IHN0cmluZywgYXJyYXk6IHN0cmluZ1tdLCBjb250ZW50czogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChhcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIFV0aWwuZXJyb3IoJ0Nhbm5vdCB3cml0ZSBmaWxlIGZyb20gYW4gZW1wdHkgYXJyYXkhJyk7XG4gICAgICAgICAgICBjb25zb2xlLnRyYWNlKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGN1cnJlbnRQYXRoID0gYmFzZVBhdGg7XG4gICAgICAgIGxldCBjb3VudCA9IGFycmF5Lmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudCAtIDE7IGkrKykge1xuICAgICAgICAgICAgY3VycmVudFBhdGggPSBwYXRoLmpvaW4oY3VycmVudFBhdGgsIGFycmF5W2ldKTtcbiAgICAgICAgICAgIGlmICghVXRpbC5jcmVhdGVEaXJlY3RvcnkoY3VycmVudFBhdGgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKHBhdGguam9pbihjdXJyZW50UGF0aCwgYXJyYXlbY291bnQgLSAxXSksIGNvbnRlbnRzKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgVXRpbC5lcnJvcignRXJyb3Igd3JpdGluZyB0byBgJyArIGJhc2VQYXRoICsgJ2AhJyk7XG4gICAgICAgICAgICBVdGlsLnN0YWNrVHJhY2UoZSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTG9hZHMgZmlsZSBmcm9tIHRoZSBzcGVjaWZpZWQgcGF0aCBpZiBwb3NzaWJsZSwgcmV0dXJucyB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICogQGRlcHJlY2F0ZWQgVXNlIGBmcy5yZWFkRmlsZVN5bmMoKWAgZGlyZWN0bHlcbiAgICAgKiBAc2luY2UgMC4xLjIgUmVtb3ZlZCB0cnkvY2F0Y2ggYmxvY2tcbiAgICAgKiBAc2luY2UgMC4wLjFcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGdldEZpbGVDb250ZW50cyhmaWxlUGF0aDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgVXRpbC5kZWJ1ZygnUmVhZGluZyBjb250ZW50cyBvZiBgJyArIGZpbGVQYXRoICsgJ2AuLi4nKTtcbiAgICAgICAgcmV0dXJuIGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgKiBAc2luY2UgMC4wLjFcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGNyZWF0ZURpcmVjdG9yeShkaXJlY3RvcnlQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhkaXJlY3RvcnlQYXRoKSkge1xuICAgICAgICAgICAgICAgIGZzLm1rZGlyU3luYyhkaXJlY3RvcnlQYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBVdGlsLmVycm9yKCdFcnJvciBjcmVhdGluZyBkaXJlY3RvcnkgYCcgKyBkaXJlY3RvcnlQYXRoICsgJ2AuJyk7XG4gICAgICAgICAgICBVdGlsLnN0YWNrVHJhY2UoZSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWN1cnNpdmVseSByZW1vdmVzIGEgZGlyZWN0b3J5IGlmIGl0IGV4aXN0c1xuICAgICAqIEBzaW5jZSAwLjAuMVxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcmVtb3ZlRGlyZWN0b3J5KGRpcmVjdG9yeVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICBsZXQgZmlsZXMgPSBbXTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGRpcmVjdG9yeVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhkaXJlY3RvcnlQYXRoKTtcbiAgICAgICAgICAgICAgICBmaWxlcy5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjdXJyZW50UGF0aCA9IHBhdGguam9pbihkaXJlY3RvcnlQYXRoLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZzLmxzdGF0U3luYyhjdXJyZW50UGF0aCkuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbC5yZW1vdmVEaXJlY3RvcnkoY3VycmVudFBhdGgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhjdXJyZW50UGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBmcy5ybWRpclN5bmMoZGlyZWN0b3J5UGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIFV0aWwuZXJyb3IoJ0NvdWxkIG5vdCByZWN1cnNpdmVseSByZW1vdmUgYSBkaXJlY3RvcnkhJyk7XG4gICAgICAgICAgICBVdGlsLnN0YWNrVHJhY2UoZSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBhbGwgY29uc2VxdWVudCBsZWFkaW5nIGFuZCB0cmFpbGluZyBmb3J3YXJkIHNsYXNoZXNcbiAgICAgKiBAc2luY2UgMC4wLjFcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHN0cmlwU2xhc2hlcyhzdHJpbmdXaXRoU2xhc2hlczogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgc3RyaW5nV2l0aFNsYXNoZXMgPSBzdHJpbmdXaXRoU2xhc2hlcy5yZXBsYWNlKG5ldyBSZWdFeHAoJ14vKicpLCAnJyk7XG4gICAgICAgIHN0cmluZ1dpdGhTbGFzaGVzID0gc3RyaW5nV2l0aFNsYXNoZXMucmVwbGFjZShuZXcgUmVnRXhwKCcvKiQnKSwgJycpO1xuICAgICAgICByZXR1cm4gc3RyaW5nV2l0aFNsYXNoZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQnJlYWtzIGEgVVJJIGRvd24gaW50byBjb21wb25lbnRzXG4gICAgICogQHNpbmNlIDAuMC4xXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBnZXRVcmlDb21wb25lbnRzKHVyaTogc3RyaW5nKTogc3RyaW5nW10ge1xuICAgICAgICBsZXQgc3RyaXBwZWRVcmkgPSBVdGlsLnN0cmlwU2xhc2hlcyh1cmkpO1xuICAgICAgICBsZXQgY29tcG9uZW50cyA9IHN0cmlwcGVkVXJpLnNwbGl0KCcvJyk7XG4gICAgICAgIGlmIChjb21wb25lbnRzWzBdID09PSAnJykge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21wb25lbnRzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4dHJhY3RzIHRoZSBmaWxlbmFtZSBmcm9tIHBhdGgsIHJlbW92aW5nIHRoZSBleHRlbnNpb25cbiAgICAgKiBAc2luY2UgMC4wLjFcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGV4dHJhY3RGaWxlTmFtZShmaWxlUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBwYXRoLmJhc2VuYW1lKGZpbGVQYXRoKS5yZXBsYWNlKC9cXC5bXi8uXSskLywgJycpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBkZXByZWNhdGVkIFVzZSBTdHJpbmdIZWxwZXIucmFuZG9tKCkgaW5zdGVhZFxuICAgICAqIEBzaW5jZSAwLjEuMFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZ2VuZXJhdGVSYW5kb21TdHJpbmcobGVuZ3RoOiBudW1iZXIpOiBzdHJpbmcge1xuICAgICAgICBsZXQgY2hhcmFjdGVycyA9ICcwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7XG4gICAgICAgIGxldCByZXN1bHQgPSAnJztcbiAgICAgICAgZm9yIChsZXQgaSA9IGxlbmd0aDsgaSA+IDA7IC0taSkge1xuICAgICAgICAgICAgcmVzdWx0ICs9IGNoYXJhY3RlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY2hhcmFjdGVycy5sZW5ndGgpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiBhbiBvYmplY3QgaXMgZW1wdHksIGkuZS4gaXMgYHt9YFxuICAgICAqIEBzaW5jZSAwLjEuNFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgaXNFbXB0eShvYmplY3Q6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqZWN0KS5sZW5ndGggPT09IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBpZiBvYmplY3QgaXMgYSBzdHJpbmcgYW5kIGZhbHNlIG90aGVyd2lzZVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgaXNTdHJpbmcob2JqZWN0OiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBvYmplY3QgPT09ICdzdHJpbmcnO1xuICAgIH1cbn1cbiJdfQ==
