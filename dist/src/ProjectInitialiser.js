"use strict";
var fse = require("fs-extra");
var path = require("path");
var yesNo = require("yesno");
var Logger_1 = require("./Logger");
var Util_1 = require("./Util");
exports.DEFAULT_TEMPLATE = 'portfolio';
var ProjectInitialiser = (function () {
    function ProjectInitialiser(projectPath, templatesPath) {
        this.projectPath = projectPath;
        this.templatesPath = templatesPath;
    }
    ProjectInitialiser.prototype.findTemplate = function (templateName) {
        var allTemplates = fse.readdirSync(this.templatesPath);
        if (allTemplates.indexOf(templateName) === -1) {
            throw new Error('Template `' + Logger_1.Logger.brand(templateName) + '` does not exist!');
        }
        return path.join(this.templatesPath, templateName);
    };
    ProjectInitialiser.prepareConfig = function (configPath) {
        var configContents = fse.readFileSync(configPath, 'utf8');
        configContents = configContents.replace(/\$\{BLITZ_VERSION}/g, Util_1.Util.getPackageInfo().version);
        fse.writeFileSync(configPath, configContents);
    };
    ProjectInitialiser.copyTemplate = function (templatePath, targetPath) {
        var templateContents = fse.readdirSync(templatePath);
        for (var i = 0; i < templateContents.length; i++) {
            var templatePart = templateContents[i];
            switch (templatePart) {
                case 'build':
                    continue;
                case 'blitz.yml':
                    var configPath = path.join(targetPath, templatePart);
                    fse.copySync(path.join(templatePath, templatePart), configPath);
                    ProjectInitialiser.prepareConfig(configPath);
                    break;
                default:
                    fse.copySync(path.join(templatePath, templatePart), path.join(targetPath, templatePart));
            }
        }
    };
    ProjectInitialiser.prototype.initialise = function (templateName, callback) {
        var _this = this;
        try {
            var templatePath_1 = this.findTemplate(templateName);
            fse.ensureDirSync(this.projectPath);
            var projectPathContents = fse.readdirSync(this.projectPath);
            if (projectPathContents.length > 0) {
                var question = Logger_1.Logger.log('Target path is not empty. Overwrite files? [y/N]', Logger_1.LogLevel.Warn, false);
                yesNo.ask(question, false, function (answer) {
                    if (answer) {
                        ProjectInitialiser.copyTemplate(templatePath_1, _this.projectPath);
                        return callback();
                    }
                    else {
                        return callback('Initialisation aborted, project path is not empty.');
                    }
                }, ['y'], ['N']);
            }
            else {
                ProjectInitialiser.copyTemplate(templatePath_1, this.projectPath);
                return callback();
            }
        }
        catch (exception) {
            return callback('Could not initialise project: ' + exception.message);
        }
    };
    return ProjectInitialiser;
}());
exports.ProjectInitialiser = ProjectInitialiser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Qcm9qZWN0SW5pdGlhbGlzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQVFBLDhCQUFnQztBQUNoQywyQkFBNkI7QUFDN0IsNkJBQStCO0FBQy9CLG1DQUEwQztBQUMxQywrQkFBNEI7QUFNZixRQUFBLGdCQUFnQixHQUFHLFdBQVcsQ0FBQztBQU01QztJQWlCSSw0QkFBbUIsV0FBbUIsRUFBRSxhQUFxQjtRQUN6RCxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztJQUN2QyxDQUFDO0lBTU8seUNBQVksR0FBcEIsVUFBcUIsWUFBb0I7UUFDckMsSUFBSSxZQUFZLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDdkQsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxZQUFZLEdBQUcsZUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3JGLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFNYyxnQ0FBYSxHQUE1QixVQUE2QixVQUFrQjtRQUMzQyxJQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMxRCxjQUFjLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxXQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUYsR0FBRyxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQU1j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Y2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIENvbnRhaW5zIGNvZGUgcmVsYXRlZCB0byBpbml0aWFsaXNpbmcgb2YgQmxpdHogcHJvamVjdHMgZnJvbSB0ZW1wbGF0ZXNcbiAqIEBhdXRob3IgVGltdXIgS3V6aGFnYWxpeWV2IDx0aW0ua3V6aEBnbWFpbC5jb20+XG4gKiBAY29weXJpZ2h0IDIwMTZcbiAqIEBsaWNlbnNlIEdQTC0zLjBcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5cbmltcG9ydCAqIGFzIGZzZSBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0ICogYXMgeWVzTm8gZnJvbSAneWVzbm8nO1xuaW1wb3J0IHtMb2dnZXIsIExvZ0xldmVsfSBmcm9tICcuL0xvZ2dlcic7XG5pbXBvcnQge1V0aWx9IGZyb20gJy4vVXRpbCc7XG5cbi8qKlxuICogVGVtcGxhdGUgdXNlZCBmb3IgcHJvamVjdCBpbml0aWFsaXNhdGlvbiBieSBkZWZhdWx0XG4gKiBAc2luY2UgMC4yLjBcbiAqL1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfVEVNUExBVEUgPSAncG9ydGZvbGlvJztcblxuLyoqXG4gKiBAY2xhc3MgRXhwb3NlcyBBUEkgZm9yIGluaXRpYWxpc2luZyBvZiBhIEJsaXR6IHByb2plY3QgZnJvbSBhIHRlbXBsYXRlXG4gKiBAc2luY2UgMC4yLjBcbiAqL1xuZXhwb3J0IGNsYXNzIFByb2plY3RJbml0aWFsaXNlciB7XG4gICAgLyoqXG4gICAgICogRGlyZWN0b3J5IGluIHdoaWNoIHRoZSBwcm9qZWN0IHdpbGwgYmUgaW5pdGlhbGlzZWQuIENyZWF0ZWQgaWYgaXQgZG9lc24ndCBleGlzdC5cbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIHByb2plY3RQYXRoOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBEaXJlY3RvcnkgaW4gd2hpY2ggYWxsIHRlbXBsYXRlcyBhcmUgbGlzdGVkLlxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgdGVtcGxhdGVzUGF0aDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogUHJvamVjdEluaXRpYWxpc2VyIGNvbnN0cnVjdG9yXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHByb2plY3RQYXRoOiBzdHJpbmcsIHRlbXBsYXRlc1BhdGg6IHN0cmluZykge1xuICAgICAgICB0aGlzLnByb2plY3RQYXRoID0gcHJvamVjdFBhdGg7XG4gICAgICAgIHRoaXMudGVtcGxhdGVzUGF0aCA9IHRlbXBsYXRlc1BhdGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgcGF0aCB0byB0aGUgdGVtcGxhdGUgaWYgaXQgZXhpc3RzLCB0aHJvd3MgYW4gZXJyb3Igb3RoZXJ3aXNlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBmaW5kVGVtcGxhdGUodGVtcGxhdGVOYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgYWxsVGVtcGxhdGVzID0gZnNlLnJlYWRkaXJTeW5jKHRoaXMudGVtcGxhdGVzUGF0aCk7XG4gICAgICAgIGlmIChhbGxUZW1wbGF0ZXMuaW5kZXhPZih0ZW1wbGF0ZU5hbWUpID09PSAtMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUZW1wbGF0ZSBgJyArIExvZ2dlci5icmFuZCh0ZW1wbGF0ZU5hbWUpICsgJ2AgZG9lcyBub3QgZXhpc3QhJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhdGguam9pbih0aGlzLnRlbXBsYXRlc1BhdGgsIHRlbXBsYXRlTmFtZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVwbGFjZXMgdmFyaW91cyBrZXl3b3JkcyBpbiB0aGUgY29uZmlnXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgcHJlcGFyZUNvbmZpZyhjb25maWdQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGNvbmZpZ0NvbnRlbnRzID0gZnNlLnJlYWRGaWxlU3luYyhjb25maWdQYXRoLCAndXRmOCcpO1xuICAgICAgICBjb25maWdDb250ZW50cyA9IGNvbmZpZ0NvbnRlbnRzLnJlcGxhY2UoL1xcJFxce0JMSVRaX1ZFUlNJT059L2csIFV0aWwuZ2V0UGFja2FnZUluZm8oKS52ZXJzaW9uKTtcbiAgICAgICAgZnNlLndyaXRlRmlsZVN5bmMoY29uZmlnUGF0aCwgY29uZmlnQ29udGVudHMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvcGllcyBmaWxlcyBmcm9tIG9uZSBkaXJlY3RvcnkgaW50byBhbm90aGVyLCBhZGp1c3QgY29udGVudHMgb2YgZmlsZXMgd2hlcmUgbmVjZXNzYXJ5XG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgY29weVRlbXBsYXRlKHRlbXBsYXRlUGF0aDogc3RyaW5nLCB0YXJnZXRQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHRlbXBsYXRlQ29udGVudHMgPSBmc2UucmVhZGRpclN5bmModGVtcGxhdGVQYXRoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wbGF0ZUNvbnRlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgdGVtcGxhdGVQYXJ0ID0gdGVtcGxhdGVDb250ZW50c1tpXTtcbiAgICAgICAgICAgIHN3aXRjaCAodGVtcGxhdGVQYXJ0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYnVpbGQnOlxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlICdibGl0ei55bWwnOlxuICAgICAgICAgICAgICAgICAgICBsZXQgY29uZmlnUGF0aCA9IHBhdGguam9pbih0YXJnZXRQYXRoLCB0ZW1wbGF0ZVBhcnQpO1xuICAgICAgICAgICAgICAgICAgICBmc2UuY29weVN5bmMocGF0aC5qb2luKHRlbXBsYXRlUGF0aCwgdGVtcGxhdGVQYXJ0KSwgY29uZmlnUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIFByb2plY3RJbml0aWFsaXNlci5wcmVwYXJlQ29uZmlnKGNvbmZpZ1BhdGgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBmc2UuY29weVN5bmMocGF0aC5qb2luKHRlbXBsYXRlUGF0aCwgdGVtcGxhdGVQYXJ0KSwgcGF0aC5qb2luKHRhcmdldFBhdGgsIHRlbXBsYXRlUGFydCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGlzZXMgcHJvamVjdCBpbiB0aGUgc3BlY2lmaWVkIGRpcmVjdG9yeSB1c2luZyB0aGUgc3BlY2lmaWVkIHRlbXBsYXRlIChpZiBpdCBleGlzdHMpXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGluaXRpYWxpc2UodGVtcGxhdGVOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiAoZXJyb3I/OiBzdHJpbmcpID0+IHZvaWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCB0ZW1wbGF0ZVBhdGggPSB0aGlzLmZpbmRUZW1wbGF0ZSh0ZW1wbGF0ZU5hbWUpO1xuICAgICAgICAgICAgZnNlLmVuc3VyZURpclN5bmModGhpcy5wcm9qZWN0UGF0aCk7XG4gICAgICAgICAgICBsZXQgcHJvamVjdFBhdGhDb250ZW50cyA9IGZzZS5yZWFkZGlyU3luYyh0aGlzLnByb2plY3RQYXRoKTtcbiAgICAgICAgICAgIGlmIChwcm9qZWN0UGF0aENvbnRlbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBsZXQgcXVlc3Rpb24gPSBMb2dnZXIubG9nKFxuICAgICAgICAgICAgICAgICAgICAnVGFyZ2V0IHBhdGggaXMgbm90IGVtcHR5LiBPdmVyd3JpdGUgZmlsZXM/IFt5L05dJyxcbiAgICAgICAgICAgICAgICAgICAgTG9nTGV2ZWwuV2FybixcbiAgICAgICAgICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICApIGFzIHN0cmluZztcbiAgICAgICAgICAgICAgICB5ZXNOby5hc2socXVlc3Rpb24sIGZhbHNlLCAoYW5zd2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFByb2plY3RJbml0aWFsaXNlci5jb3B5VGVtcGxhdGUodGVtcGxhdGVQYXRoLCB0aGlzLnByb2plY3RQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCdJbml0aWFsaXNhdGlvbiBhYm9ydGVkLCBwcm9qZWN0IHBhdGggaXMgbm90IGVtcHR5LicpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgWyd5J10sIFsnTiddKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgUHJvamVjdEluaXRpYWxpc2VyLmNvcHlUZW1wbGF0ZSh0ZW1wbGF0ZVBhdGgsIHRoaXMucHJvamVjdFBhdGgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygnQ291bGQgbm90IGluaXRpYWxpc2UgcHJvamVjdDogJyArIGV4Y2VwdGlvbi5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
