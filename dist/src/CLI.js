"use strict";
var nomnom = require('nomnom');
var path = require('path');
var ProjectInitialiser_1 = require('./ProjectInitialiser');
var Logger_1 = require('./Logger');
var Blitz_1 = require('./Blitz');
var Config_1 = require('./Config');
var SiteGenerator_1 = require('./SiteGenerator');
var Util_1 = require('./Util');
exports.CLI_NAME = 'blitz';
var CLI = (function () {
    function CLI() {
    }
    CLI.run = function (argv) {
        var parser = nomnom();
        global.debug = false;
        global.verbose = false;
        parser.script(exports.CLI_NAME);
        parser.printer(function (message) {
            var strings = Logger_1.Logger.split(message);
            var verboseState = global.verbose;
            if (strings[0].substr(0, 5) === 'Usage' || strings[0].substr(0, 5) === 'blitz') {
                global.verbose = true;
            }
            for (var i = 0; i < strings.length; i++) {
                if (strings[i].match(/^command/)) {
                    strings[i] = 'Commands:';
                }
            }
            Logger_1.Logger.logMany(strings);
            global.verbose = verboseState;
        });
        parser.nocommand().callback(function () { return CLI.version(); });
        parser.option('verbose', {
            abbr: 'v',
            flag: true,
            help: 'displays warnings and log output',
            callback: function (flagSet) { return global.verbose = flagSet; },
        });
        parser.option('debug', {
            abbr: 'd',
            flag: true,
            help: 'displays debug output',
            callback: function (flagSet) { return global.debug = flagSet; },
        });
        parser.command('init')
            .option('template', {
            abbr: 't',
            default: ProjectInitialiser_1.DEFAULT_TEMPLATE,
            help: 'template name',
        })
            .option('path', {
            abbr: 'p',
            default: process.cwd(),
            help: 'path to project folder',
        })
            .help('initialise a project from template')
            .callback(function (opts) { return Blitz_1.Blitz.init(opts.template, opts.path); });
        parser.command('build')
            .option('config', {
            abbr: 'c',
            default: path.join(process.cwd(), Config_1.DEFAULT_CONFIG_NAME),
            help: 'path to Blitz config',
        })
            .option('build', {
            abbr: 'b',
            default: path.join(process.cwd(), SiteGenerator_1.DEFAULT_BUILD_DIRECTORY_NAME),
            help: 'path to target build directory',
        })
            .help('builds site using `blitz.yml`')
            .callback(function (opts) { return Blitz_1.Blitz.build(opts.config, opts.build); });
        parser.command('watch')
            .option('config', {
            abbr: 'c',
            default: path.join(process.cwd(), Config_1.DEFAULT_CONFIG_NAME),
            help: 'path to Blitz config',
        })
            .option('build', {
            abbr: 'b',
            default: path.join(process.cwd(), SiteGenerator_1.DEFAULT_BUILD_DIRECTORY_NAME),
            help: 'path to target build directory',
        })
            .help('watches source code and rebuilds the website when necessary')
            .callback(function (opts) {
            global.verbose = true;
            Blitz_1.Blitz.watch(opts.config, opts.build);
        });
        parser.command('preview')
            .option('config', {
            abbr: 'c',
            default: path.join(process.cwd(), Config_1.DEFAULT_CONFIG_NAME),
            help: 'path to Blitz config',
        })
            .option('build', {
            abbr: 'b',
            default: path.join(process.cwd(), SiteGenerator_1.DEFAULT_BUILD_DIRECTORY_NAME),
            help: 'path to target build directory',
        })
            .help('starts a web server for real-time change preview')
            .callback(function (opts) {
            global.verbose = true;
            Blitz_1.Blitz.preview(opts.config, opts.build);
        });
        var normalisedArgv = argv.slice(2);
        exports.args = parser.parse(normalisedArgv);
    };
    CLI.version = function () {
        var verboseState = global.verbose;
        global.verbose = true;
        Logger_1.Logger.log('Blitz v' + Util_1.Util.getPackageInfo().version + ', use `' + Logger_1.Logger.brand('blitz -h') + '` for help');
        Logger_1.Logger.log('For documentation, refer to ' + Logger_1.Logger.brand('https://getblitz.io/'));
        global.verbose = verboseState;
    };
    return CLI;
}());
exports.CLI = CLI;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUM7UUFFUCxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25DLFlBQUksR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFNYSxXQUFPLEdBQXJCO1FBQ0ksSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUNsQyxNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUN0QixlQUFNLENBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxXQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxHQUFHLFNBQVMsR0FBRyxlQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLFlBQVksQ0FBQyxDQUFDO1FBQzVHLGVBQU0sQ0FBQyxHQUFHLENBQUMsOEJBQThCLEdBQUcsZUFBTSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7UUFDbEYsTUFBTSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUM7SUFDbEMsQ0FBQztJQUNMLFVBQUM7QUFBRCxDQWpIQSxBQWlIQyxJQUFBO0FBakhZLFdBQUcsTUFpSGYsQ0FBQSIsImZpbGUiOiJzcmMvQ0xJLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBDb250YWlucyBjb2RlIHJlc3BvbnNpYmxlIGZvciByb3V0aW5nIGBibGl0emAgQ0xJIGNvbW1hbmRzIHRvIHRoZSBgYmxpdHpgIG1vZHVsZVxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0ICogYXMgbm9tbm9tIGZyb20gJ25vbW5vbSc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtERUZBVUxUX1RFTVBMQVRFfSBmcm9tICcuL1Byb2plY3RJbml0aWFsaXNlcic7XG5pbXBvcnQge0xvZ2dlcn0gZnJvbSAnLi9Mb2dnZXInO1xuaW1wb3J0IHtCbGl0en0gZnJvbSAnLi9CbGl0eic7XG5pbXBvcnQge0RFRkFVTFRfQ09ORklHX05BTUV9IGZyb20gJy4vQ29uZmlnJztcbmltcG9ydCB7REVGQVVMVF9CVUlMRF9ESVJFQ1RPUllfTkFNRX0gZnJvbSAnLi9TaXRlR2VuZXJhdG9yJztcbmltcG9ydCB7VXRpbH0gZnJvbSAnLi9VdGlsJztcblxuLyoqXG4gKiBOYW1lIG9mIHRoZSBDTEkgY29tbWFuZCB1c2VkIHRvIHJ1biBCbGl0elxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBjb25zdCBDTElfTkFNRSA9ICdibGl0eic7XG5cbi8qKlxuICogUGFyc2VkIGFyZ3VtZW50c1xuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBsZXQgYXJncztcblxuLyoqXG4gKiBAY2xhc3MgRXhwb3NlcyBhbiBBUEkgZm9yIHRoZSBDTElcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgY2xhc3MgQ0xJIHtcbiAgICAvKipcbiAgICAgKiBQYXJzZXMgY29tbWFuZCBsaW5lIGFyZ3VtZW50cyBhbmQgcnVucyByZWxldmFudCBtZXRob2RzXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBydW4oYXJndjogc3RyaW5nW10pIHtcbiAgICAgICAgbGV0IHBhcnNlciA9IG5vbW5vbSgpO1xuXG4gICAgICAgIGdsb2JhbC5kZWJ1ZyA9IGZhbHNlO1xuICAgICAgICBnbG9iYWwudmVyYm9zZSA9IGZhbHNlO1xuXG4gICAgICAgIHBhcnNlci5zY3JpcHQoQ0xJX05BTUUpO1xuICAgICAgICBwYXJzZXIucHJpbnRlcigobWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgbGV0IHN0cmluZ3MgPSBMb2dnZXIuc3BsaXQobWVzc2FnZSk7XG4gICAgICAgICAgICBsZXQgdmVyYm9zZVN0YXRlID0gZ2xvYmFsLnZlcmJvc2U7XG4gICAgICAgICAgICBpZiAoc3RyaW5nc1swXS5zdWJzdHIoMCwgNSkgPT09ICdVc2FnZScgfHwgc3RyaW5nc1swXS5zdWJzdHIoMCwgNSkgPT09ICdibGl0eicpIHtcbiAgICAgICAgICAgICAgICBnbG9iYWwudmVyYm9zZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RyaW5nc1tpXS5tYXRjaCgvXmNvbW1hbmQvKSkge1xuICAgICAgICAgICAgICAgICAgICBzdHJpbmdzW2ldID0gJ0NvbW1hbmRzOic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTG9nZ2VyLmxvZ01hbnkoc3RyaW5ncyk7XG4gICAgICAgICAgICBnbG9iYWwudmVyYm9zZSA9IHZlcmJvc2VTdGF0ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcnNlci5ub2NvbW1hbmQoKS5jYWxsYmFjaygoKSA9PiBDTEkudmVyc2lvbigpKTtcbiAgICAgICAgcGFyc2VyLm9wdGlvbigndmVyYm9zZScsIHtcbiAgICAgICAgICAgIGFiYnI6ICd2JyxcbiAgICAgICAgICAgIGZsYWc6IHRydWUsXG4gICAgICAgICAgICBoZWxwOiAnZGlzcGxheXMgd2FybmluZ3MgYW5kIGxvZyBvdXRwdXQnLFxuICAgICAgICAgICAgY2FsbGJhY2s6IChmbGFnU2V0KSA9PiBnbG9iYWwudmVyYm9zZSA9IGZsYWdTZXQsXG4gICAgICAgIH0pO1xuICAgICAgICBwYXJzZXIub3B0aW9uKCdkZWJ1ZycsIHtcbiAgICAgICAgICAgIGFiYnI6ICdkJyxcbiAgICAgICAgICAgIGZsYWc6IHRydWUsXG4gICAgICAgICAgICBoZWxwOiAnZGlzcGxheXMgZGVidWcgb3V0cHV0JyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoZmxhZ1NldCkgPT4gZ2xvYmFsLmRlYnVnID0gZmxhZ1NldCxcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcnNlci5jb21tYW5kKCdpbml0JylcbiAgICAgICAgICAgIC5vcHRpb24oJ3RlbXBsYXRlJywge1xuICAgICAgICAgICAgICAgIGFiYnI6ICd0JyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBERUZBVUxUX1RFTVBMQVRFLFxuICAgICAgICAgICAgICAgIGhlbHA6ICd0ZW1wbGF0ZSBuYW1lJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub3B0aW9uKCdwYXRoJywge1xuICAgICAgICAgICAgICAgIGFiYnI6ICdwJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBwcm9jZXNzLmN3ZCgpLFxuICAgICAgICAgICAgICAgIGhlbHA6ICdwYXRoIHRvIHByb2plY3QgZm9sZGVyJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuaGVscCgnaW5pdGlhbGlzZSBhIHByb2plY3QgZnJvbSB0ZW1wbGF0ZScpXG4gICAgICAgICAgICAuY2FsbGJhY2soKG9wdHMpID0+IEJsaXR6LmluaXQob3B0cy50ZW1wbGF0ZSwgb3B0cy5wYXRoKSk7XG4gICAgICAgIHBhcnNlci5jb21tYW5kKCdidWlsZCcpXG4gICAgICAgICAgICAub3B0aW9uKCdjb25maWcnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ2MnLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBERUZBVUxUX0NPTkZJR19OQU1FKSxcbiAgICAgICAgICAgICAgICBoZWxwOiAncGF0aCB0byBCbGl0eiBjb25maWcnLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcHRpb24oJ2J1aWxkJywge1xuICAgICAgICAgICAgICAgIGFiYnI6ICdiJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgREVGQVVMVF9CVUlMRF9ESVJFQ1RPUllfTkFNRSksXG4gICAgICAgICAgICAgICAgaGVscDogJ3BhdGggdG8gdGFyZ2V0IGJ1aWxkIGRpcmVjdG9yeScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmhlbHAoJ2J1aWxkcyBzaXRlIHVzaW5nIGBibGl0ei55bWxgJylcbiAgICAgICAgICAgIC5jYWxsYmFjaygob3B0cykgPT4gQmxpdHouYnVpbGQob3B0cy5jb25maWcsIG9wdHMuYnVpbGQpKTtcbiAgICAgICAgcGFyc2VyLmNvbW1hbmQoJ3dhdGNoJylcbiAgICAgICAgICAgIC5vcHRpb24oJ2NvbmZpZycsIHtcbiAgICAgICAgICAgICAgICBhYmJyOiAnYycsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIERFRkFVTFRfQ09ORklHX05BTUUpLFxuICAgICAgICAgICAgICAgIGhlbHA6ICdwYXRoIHRvIEJsaXR6IGNvbmZpZycsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9wdGlvbignYnVpbGQnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ2InLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBERUZBVUxUX0JVSUxEX0RJUkVDVE9SWV9OQU1FKSxcbiAgICAgICAgICAgICAgICBoZWxwOiAncGF0aCB0byB0YXJnZXQgYnVpbGQgZGlyZWN0b3J5JyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuaGVscCgnd2F0Y2hlcyBzb3VyY2UgY29kZSBhbmQgcmVidWlsZHMgdGhlIHdlYnNpdGUgd2hlbiBuZWNlc3NhcnknKVxuICAgICAgICAgICAgLmNhbGxiYWNrKChvcHRzKSA9PiB7XG4gICAgICAgICAgICAgICAgZ2xvYmFsLnZlcmJvc2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIEJsaXR6LndhdGNoKG9wdHMuY29uZmlnLCBvcHRzLmJ1aWxkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICBwYXJzZXIuY29tbWFuZCgncHJldmlldycpXG4gICAgICAgICAgICAub3B0aW9uKCdjb25maWcnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ2MnLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBERUZBVUxUX0NPTkZJR19OQU1FKSxcbiAgICAgICAgICAgICAgICBoZWxwOiAncGF0aCB0byBCbGl0eiBjb25maWcnLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcHRpb24oJ2J1aWxkJywge1xuICAgICAgICAgICAgICAgIGFiYnI6ICdiJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgREVGQVVMVF9CVUlMRF9ESVJFQ1RPUllfTkFNRSksXG4gICAgICAgICAgICAgICAgaGVscDogJ3BhdGggdG8gdGFyZ2V0IGJ1aWxkIGRpcmVjdG9yeScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmhlbHAoJ3N0YXJ0cyBhIHdlYiBzZXJ2ZXIgZm9yIHJlYWwtdGltZSBjaGFuZ2UgcHJldmlldycpXG4gICAgICAgICAgICAuY2FsbGJhY2soKG9wdHMpID0+IHtcbiAgICAgICAgICAgICAgICBnbG9iYWwudmVyYm9zZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgQmxpdHoucHJldmlldyhvcHRzLmNvbmZpZywgb3B0cy5idWlsZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgbm9ybWFsaXNlZEFyZ3YgPSBhcmd2LnNsaWNlKDIpO1xuICAgICAgICBhcmdzID0gcGFyc2VyLnBhcnNlKG5vcm1hbGlzZWRBcmd2KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmludHMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHZlcnNpb25cbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHZlcnNpb24oKSB7XG4gICAgICAgIGxldCB2ZXJib3NlU3RhdGUgPSBnbG9iYWwudmVyYm9zZTtcbiAgICAgICAgZ2xvYmFsLnZlcmJvc2UgPSB0cnVlO1xuICAgICAgICBMb2dnZXIubG9nKCdCbGl0eiB2JyArIFV0aWwuZ2V0UGFja2FnZUluZm8oKS52ZXJzaW9uICsgJywgdXNlIGAnICsgTG9nZ2VyLmJyYW5kKCdibGl0eiAtaCcpICsgJ2AgZm9yIGhlbHAnKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnRm9yIGRvY3VtZW50YXRpb24sIHJlZmVyIHRvICcgKyBMb2dnZXIuYnJhbmQoJ2h0dHBzOi8vZ2V0YmxpdHouaW8vJykpO1xuICAgICAgICBnbG9iYWwudmVyYm9zZSA9IHZlcmJvc2VTdGF0ZTtcbiAgICB9XG59XG4iXX0=
