"use strict";
var path = require('path');
var fse = require('fs-extra');
var yaml = require('js-yaml');
var ProjectInitialiser_1 = require('./ProjectInitialiser');
var Logger_1 = require('./Logger');
var Config_1 = require('./Config');
var ProjectWatcher_1 = require('./ProjectWatcher');
var events_1 = require('events');
var ProjectPreviewer_1 = require('./ProjectPreviewer');
var Blitz = (function () {
    function Blitz() {
    }
    Blitz.init = function (templateName, projectPath) {
        Logger_1.Logger.log('Initialising a new project in `' +
            Logger_1.Logger.brand(projectPath) + '` using the template `' +
            Logger_1.Logger.brand(templateName) + '`...', Logger_1.LogLevel.Debug);
        var templatesPath = path.join(__dirname, '..', '..', 'templates');
        var projectInitialiser = new ProjectInitialiser_1.ProjectInitialiser(projectPath, templatesPath);
        projectInitialiser.initialise(templateName, function (error) {
            if (error) {
                Logger_1.Logger.logMany(Logger_1.Logger.split(error), Logger_1.LogLevel.Error);
                process.exit(1);
            }
            Logger_1.Logger.log('Project initialised!');
            process.exit(0);
        });
    };
    Blitz.build = function (configPath, buildPath) {
        Logger_1.Logger.log('Building site...');
        Logger_1.Logger.log('Building site using `' +
            Logger_1.Logger.brand(configPath) + '` in directory `' +
            Logger_1.Logger.brand(buildPath) + '`...', Logger_1.LogLevel.Debug);
        var configContents = fse.readFileSync(configPath, 'utf8');
        var rawConfig = yaml.safeLoad(configContents);
        if (!rawConfig) {
            rawConfig = {};
        }
        var config = new Config_1.Config();
        config.load(rawConfig);
        try {
            config.validate();
        }
        catch (exception) {
            Logger_1.Logger.log('Error validating the config:', Logger_1.LogLevel.Error);
            Logger_1.Logger.logMany(Logger_1.Logger.split(exception.message), Logger_1.LogLevel.Error);
            process.exit(1);
        }
        console.log(config.get());
    };
    Blitz.watch = function (configPath, buildPath) {
        Logger_1.Logger.log('Starting project watcher...');
        Logger_1.Logger.log('Watching the project using `' +
            Logger_1.Logger.brand(configPath) + '` with build located in `' +
            Logger_1.Logger.brand(buildPath) + '`...', Logger_1.LogLevel.Debug);
        var eventEmitter = new events_1.EventEmitter();
        var projectWatcher = new ProjectWatcher_1.ProjectWatcher(configPath, buildPath, eventEmitter);
        projectWatcher.watch();
    };
    Blitz.preview = function (configPath, buildPath) {
        Logger_1.Logger.log('Starting preview server...');
        Logger_1.Logger.log('Previewing the project using `' +
            Logger_1.Logger.brand(configPath) + '` with build located in `' +
            Logger_1.Logger.brand(buildPath) + '`...', Logger_1.LogLevel.Debug);
        var eventEmitter = new events_1.EventEmitter();
        var projectPreviewer = new ProjectPreviewer_1.ProjectPreviewer(configPath, buildPath, eventEmitter);
        projectPreviewer.startServer();
    };
    return Blitz;
}());
exports.Blitz = Blitz;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RSxZQUFZLENBQUMsQ0FBQztRQUNqRixnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBQ0wsWUFBQztBQUFELENBNUVBLEFBNEVDLElBQUE7QUE1RVksYUFBSyxRQTRFakIsQ0FBQSIsImZpbGUiOiJzcmMvQmxpdHouanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEZpbGUgY29udGFpbmluZyB0aGUgY29yZSBvZiBCbGl0elxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGZzZSBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgKiBhcyB5YW1sIGZyb20gJ2pzLXlhbWwnO1xuaW1wb3J0IHtQcm9qZWN0SW5pdGlhbGlzZXJ9IGZyb20gJy4vUHJvamVjdEluaXRpYWxpc2VyJztcbmltcG9ydCB7TG9nZ2VyLCBMb2dMZXZlbH0gZnJvbSAnLi9Mb2dnZXInO1xuaW1wb3J0IHtDb25maWd9IGZyb20gJy4vQ29uZmlnJztcbmltcG9ydCB7UHJvamVjdFdhdGNoZXJ9IGZyb20gJy4vUHJvamVjdFdhdGNoZXInO1xuaW1wb3J0IHtFdmVudEVtaXR0ZXJ9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQge1Byb2plY3RQcmV2aWV3ZXJ9IGZyb20gJy4vUHJvamVjdFByZXZpZXdlcic7XG5cbi8qKlxuICogQGNsYXNzIE1haW4gY2xhc3Mgb2YgQmxpdHosIGV4cG9zZXMgdGhlIEFQSSBmb3IgZXh0ZXJuYWwgbW9kdWxlcyB0byB1c2VcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgY2xhc3MgQmxpdHoge1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpc2VzIGEgQmxpdHogcHJvamVjdCBmcm9tIGEgdGVtcGxhdGVcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGluaXQodGVtcGxhdGVOYW1lOiBzdHJpbmcsIHByb2plY3RQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgTG9nZ2VyLmxvZygnSW5pdGlhbGlzaW5nIGEgbmV3IHByb2plY3QgaW4gYCcgK1xuICAgICAgICAgICAgTG9nZ2VyLmJyYW5kKHByb2plY3RQYXRoKSArICdgIHVzaW5nIHRoZSB0ZW1wbGF0ZSBgJyArXG4gICAgICAgICAgICBMb2dnZXIuYnJhbmQodGVtcGxhdGVOYW1lKSArICdgLi4uJywgTG9nTGV2ZWwuRGVidWcpO1xuICAgICAgICBsZXQgdGVtcGxhdGVzUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICcuLicsICd0ZW1wbGF0ZXMnKTtcbiAgICAgICAgbGV0IHByb2plY3RJbml0aWFsaXNlciA9IG5ldyBQcm9qZWN0SW5pdGlhbGlzZXIocHJvamVjdFBhdGgsIHRlbXBsYXRlc1BhdGgpO1xuICAgICAgICBwcm9qZWN0SW5pdGlhbGlzZXIuaW5pdGlhbGlzZSh0ZW1wbGF0ZU5hbWUsIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgTG9nZ2VyLmxvZ01hbnkoTG9nZ2VyLnNwbGl0KGVycm9yKSwgTG9nTGV2ZWwuRXJyb3IpO1xuICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIExvZ2dlci5sb2coJ1Byb2plY3QgaW5pdGlhbGlzZWQhJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyB0aGUgd2Vic2l0ZSB1c2luZyB0aGUgc3BlY2lmaWVkIGNvbmZpZy4gQXNzdW1lcyB0aGF0IGFsbCByZWxldmFudCBmb2xkZXJzIChlLmcuIGBhc3NldHNgLCBgY29udGVudGAsXG4gICAgICogYHBsdWdpbnNgLCBgdGVtcGxhdGVzYCwgZXRjLikgZXhpc3QgaW4gdGhlIHNhbWUgZGlyZWN0b3J5IGFzIHRoZSBjb25maWcuIFRoZSBnZW5lcmF0ZWQgZmlsZXMgYXJlIHBsYWNlZCBpbnRvIHRoZVxuICAgICAqIHNwZWNpZmllZCBidWlsZCBkaXJlY3RvcnkuXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBidWlsZChjb25maWdQYXRoOiBzdHJpbmcsIGJ1aWxkUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIExvZ2dlci5sb2coJ0J1aWxkaW5nIHNpdGUuLi4nKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnQnVpbGRpbmcgc2l0ZSB1c2luZyBgJyArXG4gICAgICAgICAgICBMb2dnZXIuYnJhbmQoY29uZmlnUGF0aCkgKyAnYCBpbiBkaXJlY3RvcnkgYCcgK1xuICAgICAgICAgICAgTG9nZ2VyLmJyYW5kKGJ1aWxkUGF0aCkgKyAnYC4uLicsIExvZ0xldmVsLkRlYnVnKTtcbiAgICAgICAgbGV0IGNvbmZpZ0NvbnRlbnRzID0gZnNlLnJlYWRGaWxlU3luYyhjb25maWdQYXRoLCAndXRmOCcpO1xuICAgICAgICBsZXQgcmF3Q29uZmlnID0geWFtbC5zYWZlTG9hZChjb25maWdDb250ZW50cyk7XG4gICAgICAgIGlmICghcmF3Q29uZmlnKSB7XG4gICAgICAgICAgICByYXdDb25maWcgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY29uZmlnID0gbmV3IENvbmZpZygpO1xuICAgICAgICBjb25maWcubG9hZChyYXdDb25maWcpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uZmlnLnZhbGlkYXRlKCk7XG4gICAgICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xuICAgICAgICAgICAgTG9nZ2VyLmxvZygnRXJyb3IgdmFsaWRhdGluZyB0aGUgY29uZmlnOicsIExvZ0xldmVsLkVycm9yKTtcbiAgICAgICAgICAgIExvZ2dlci5sb2dNYW55KExvZ2dlci5zcGxpdChleGNlcHRpb24ubWVzc2FnZSksIExvZ0xldmVsLkVycm9yKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhjb25maWcuZ2V0KCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdhdGNoZXMgdGhlIGN1cnJlbnQgZGlyZWN0b3J5IGFuZCByZWJ1aWxkcyBjZXJ0YWluIHBhcnRzIG9mIHRoZSB3ZWJzaXRlIHdoZW4gbmVjZXNzYXJ5XG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyB3YXRjaChjb25maWdQYXRoOiBzdHJpbmcsIGJ1aWxkUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIExvZ2dlci5sb2coJ1N0YXJ0aW5nIHByb2plY3Qgd2F0Y2hlci4uLicpO1xuICAgICAgICBMb2dnZXIubG9nKCdXYXRjaGluZyB0aGUgcHJvamVjdCB1c2luZyBgJyArXG4gICAgICAgICAgICBMb2dnZXIuYnJhbmQoY29uZmlnUGF0aCkgKyAnYCB3aXRoIGJ1aWxkIGxvY2F0ZWQgaW4gYCcgK1xuICAgICAgICAgICAgTG9nZ2VyLmJyYW5kKGJ1aWxkUGF0aCkgKyAnYC4uLicsIExvZ0xldmVsLkRlYnVnKTtcbiAgICAgICAgbGV0IGV2ZW50RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgbGV0IHByb2plY3RXYXRjaGVyID0gbmV3IFByb2plY3RXYXRjaGVyKGNvbmZpZ1BhdGgsIGJ1aWxkUGF0aCwgZXZlbnRFbWl0dGVyKTtcbiAgICAgICAgcHJvamVjdFdhdGNoZXIud2F0Y2goKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSdW5zIGEgd2ViIHNlcnZlciB3aXRoIHRoZSBwcmV2aWV3IG9mIHRoZSB3ZWJzaXRlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBwcmV2aWV3KGNvbmZpZ1BhdGg6IHN0cmluZywgYnVpbGRQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgTG9nZ2VyLmxvZygnU3RhcnRpbmcgcHJldmlldyBzZXJ2ZXIuLi4nKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnUHJldmlld2luZyB0aGUgcHJvamVjdCB1c2luZyBgJyArXG4gICAgICAgICAgICBMb2dnZXIuYnJhbmQoY29uZmlnUGF0aCkgKyAnYCB3aXRoIGJ1aWxkIGxvY2F0ZWQgaW4gYCcgK1xuICAgICAgICAgICAgTG9nZ2VyLmJyYW5kKGJ1aWxkUGF0aCkgKyAnYC4uLicsIExvZ0xldmVsLkRlYnVnKTtcbiAgICAgICAgbGV0IGV2ZW50RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgbGV0IHByb2plY3RQcmV2aWV3ZXIgPSBuZXcgUHJvamVjdFByZXZpZXdlcihjb25maWdQYXRoLCBidWlsZFBhdGgsIGV2ZW50RW1pdHRlcik7XG4gICAgICAgIHByb2plY3RQcmV2aWV3ZXIuc3RhcnRTZXJ2ZXIoKTtcbiAgICB9XG59XG4iXX0=
