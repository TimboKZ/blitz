"use strict";
var mock = require('mock-fs');
var yaml = require('js-yaml');
var chai_1 = require('chai');
var ConfigParser_1 = require('../../src/ConfigParser');
describe('ConfigParser', function () {
    describe('#load()', function () {
        it('should throw an error when file either does not exist or is not readable', function () {
            mock({
                'blitz.yml': mock.file({
                    content: '',
                    mode: 0,
                }),
            });
            chai_1.assert.throws(function () { return ConfigParser_1.ConfigParser.load('blitz.yml'); }, 'permission denied');
            mock.restore();
            mock({});
            chai_1.assert.throws(function () { return ConfigParser_1.ConfigParser.load('blitz.yml'); }, 'no such file or directory');
            mock.restore();
        });
        it('should use the default values correctly', function () {
            mock({
                'blitz.yml': mock.file({
                    content: '',
                    mode: 777,
                }),
            });
            var config = ConfigParser_1.ConfigParser.load('blitz.yml');
            mock.restore();
            var propertyCount = ConfigParser_1.CONFIG_PROPERTIES.length;
            for (var i = 0; i < propertyCount; i++) {
                var property = ConfigParser_1.CONFIG_PROPERTIES[i];
                chai_1.assert.deepEqual(config[property.name], property.defaultValue);
            }
        });
        it('should read the config correctly', function () {
            var configObject = {
                blitz_version: '9.9.9',
                globals: {
                    hello: 'world',
                    integer: 123,
                },
                pages: [
                    {
                        uri: '/',
                        template: 'index.pug',
                    },
                    {
                        template: 'help.pug',
                    },
                ],
            };
            mock({
                'blitz.yml': mock.file({
                    content: yaml.safeDump(configObject),
                    mode: 777,
                }),
            });
            var config = ConfigParser_1.ConfigParser.load('blitz.yml');
            mock.restore();
            for (var propertyName in configObject) {
                if (configObject.hasOwnProperty(propertyName)) {
                    chai_1.assert.deepEqual(config[propertyName], configObject[propertyName]);
                }
            }
        });
        it('should throw an error when an incorrect type for a required parameters is supplied', function () {
            var propertyCount = ConfigParser_1.CONFIG_PROPERTIES.length;
            for (var i = 0; i < propertyCount; i++) {
                var property = ConfigParser_1.CONFIG_PROPERTIES[i];
                var contentObject = {};
                var badValue = void 0;
                switch (typeof property.defaultValue) {
                    case 'string':
                    case 'boolean':
                        badValue = {};
                        break;
                    default:
                        badValue = 'string';
                }
                contentObject[property.name] = badValue;
                mock({
                    'blitz.yml': mock.file({
                        content: yaml.safeDump(contentObject),
                        mode: 777,
                    }),
                });
                chai_1.assert.throws(function () { return ConfigParser_1.ConfigParser.load('blitz.yml'); }, 'Invalid type');
                mock.restore();
            }
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3Rlc3QvdW5pdC9Db25maWdQYXJzZXJUZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFRQSxJQUFZLElBQUksV0FBTSxTQUFTLENBQUMsQ0FBQTtBQUNoQyxJQUFZLElBQUksV0FBTSxTQUFTLENBQUMsQ0FBQTtBQUNoQyxxQkFBcUIsTUFBTSxDQUFDLENBQUE7QUFDNUIsNkJBQThDLHdCQUF3QixDQUFDLENBQUE7QUFFdkUsUUFBUSxDQUFDLGNBQWMsRUFBRTtJQUVyQixRQUFRLENBQUMsU0FBUyxFQUFFO1FBRWhCLEVBQUUsQ0FBQywwRUFBMEUsRUFBRTtZQUMzRSxJQUFJLENBQUM7Z0JBQ0QsV0FBVyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ25CLE9BQU8sRUFBRSxFQUFFO29CQUNYLElBQUksRUFBRSxDQUFDO2lCQUNWLENBQUM7YUFDTCxDQUFDLENBQUM7WUFDSCxhQUFNLENBQUMsTUFBTSxDQUFDLGNBQU0sT0FBQSwyQkFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBOUIsQ0FBOEIsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3pFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNmLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNULGFBQU0sQ0FBQyxNQUFNLENBQUMsY0FBTSxPQUFBLDJCQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUE5QixDQUE4QixFQUFFLDJCQUEyQixDQUFDLENBQUM7WUFDakYsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25CLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlDQUF5QyxFQUFFO1lBQzFDLElBQUksQ0FBQztnQkFDRCxXQUFXLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDbkIsT0FBTyxFQUFFLEVBQUU7b0JBQ1gsSUFBSSxFQUFFLEdBQUc7aUJBQ1osQ0FBQzthQUNMLENBQUMsQ0FBQztZQUNILElBQUksTUFBTSxHQUFHLDJCQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzVDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNmLElBQUksYUFBYSxHQUFHLGdDQUFpQixDQUFDLE1BQU0sQ0FBQztZQUM3QyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLGFBQWEsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNyQyxJQUFJLFFBQVEsR0FBRyxnQ0FBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEMsYUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNuRSxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUU7WUFDbkMsSUFBSSxZQUFZLEdBQUc7Z0JBQ2YsYUFBYSxFQUFFLE9BQU87Z0JBQ3RCLE9BQU8sRUFBRTtvQkFDTCxLQUFLLEVBQUUsT0FBTztvQkFDZCxPQUFPLEVBQUUsR0FBRztpQkFDZjtnQkFDRCxLQUFLLEVBQUU7b0JBQ0g7d0JBQ0ksR0FBRyxFQUFFLEdBQUc7d0JBQ1IsUUFBUSxFQUFFLFdBQVc7cUJBQ3hCO29CQUNEO3dCQUNJLFFBQVEsRUFBRSxVQUFVO3FCQUN2QjtpQkFDSjthQUNKLENBQUM7WUFDRixJQUFJLENBQUM7Z0JBQ0QsV0FBVyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ25CLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQztvQkFDcEMsSUFBSSxFQUFFLEdBQUc7aUJBQ1osQ0FBQzthQUNMLENBQUMsQ0FBQztZQUNILElBQUksTUFBTSxHQUFHLDJCQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzVDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNmLEdBQUcsQ0FBQyxDQUFDLElBQUksWUFBWSxJQUFJLFlBQVksQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM1QyxhQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsRUFBRSxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDdkUsQ0FBQztZQUNMLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvRkFBb0YsRUFBRTtZQUNyRixJQUFJLGFBQWEsR0FBRyxnQ0FBaUIsQ0FBQyxNQUFNLENBQUM7WUFDN0MsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxhQUFhLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDckMsSUFBSSxRQUFRLEdBQUcsZ0NBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BDLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztnQkFDdkIsSUFBSSxRQUFRLFNBQUEsQ0FBQztnQkFDYixNQUFNLENBQUMsQ0FBQyxPQUFPLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO29CQUNuQyxLQUFLLFFBQVEsQ0FBQztvQkFDZCxLQUFLLFNBQVM7d0JBQ1YsUUFBUSxHQUFHLEVBQUUsQ0FBQzt3QkFDZCxLQUFLLENBQUM7b0JBQ1Y7d0JBQ0ksUUFBUSxHQUFHLFFBQVEsQ0FBQztnQkFDNUIsQ0FBQztnQkFDRCxhQUFhLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLFFBQVEsQ0FBQztnQkFDeEMsSUFBSSxDQUFDO29CQUNELFdBQVcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO3dCQUNuQixPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUM7d0JBQ3JDLElBQUksRUFBRSxHQUFHO3FCQUNaLENBQUM7aUJBQ0wsQ0FBQyxDQUFDO2dCQUNILGFBQU0sQ0FBQyxNQUFNLENBQUMsY0FBTSxPQUFBLDJCQUFZLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUE5QixDQUE4QixFQUFFLGNBQWMsQ0FBQyxDQUFDO2dCQUNwRSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbkIsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBRVAsQ0FBQyxDQUFDLENBQUM7QUFFUCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VuaXQvQ29uZmlnUGFyc2VyVGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQ29uZmlnUGFyc2VyIGNsYXNzIHRlc3RzXG4gKiBAYXV0aG9yIFRpbXVyIEt1emhhZ2FsaXlldiA8dGltLmt1emhAZ21haWwuY29tPlxuICogQGNvcHlyaWdodCAyMDE2XG4gKiBAbGljZW5zZSBHUEwtMy4wXG4gKiBAc2luY2UgMC4xLjNcbiAqL1xuXG5pbXBvcnQgKiBhcyBtb2NrIGZyb20gJ21vY2stZnMnO1xuaW1wb3J0ICogYXMgeWFtbCBmcm9tICdqcy15YW1sJztcbmltcG9ydCB7YXNzZXJ0fSBmcm9tICdjaGFpJztcbmltcG9ydCB7Q29uZmlnUGFyc2VyLCBDT05GSUdfUFJPUEVSVElFU30gZnJvbSAnLi4vLi4vc3JjL0NvbmZpZ1BhcnNlcic7XG5cbmRlc2NyaWJlKCdDb25maWdQYXJzZXInLCAoKSA9PiB7XG5cbiAgICBkZXNjcmliZSgnI2xvYWQoKScsICgpID0+IHtcblxuICAgICAgICBpdCgnc2hvdWxkIHRocm93IGFuIGVycm9yIHdoZW4gZmlsZSBlaXRoZXIgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IHJlYWRhYmxlJywgKCkgPT4ge1xuICAgICAgICAgICAgbW9jayh7XG4gICAgICAgICAgICAgICAgJ2JsaXR6LnltbCc6IG1vY2suZmlsZSh7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiAwLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhc3NlcnQudGhyb3dzKCgpID0+IENvbmZpZ1BhcnNlci5sb2FkKCdibGl0ei55bWwnKSwgJ3Blcm1pc3Npb24gZGVuaWVkJyk7XG4gICAgICAgICAgICBtb2NrLnJlc3RvcmUoKTtcbiAgICAgICAgICAgIG1vY2soe30pO1xuICAgICAgICAgICAgYXNzZXJ0LnRocm93cygoKSA9PiBDb25maWdQYXJzZXIubG9hZCgnYmxpdHoueW1sJyksICdubyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5Jyk7XG4gICAgICAgICAgICBtb2NrLnJlc3RvcmUoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB1c2UgdGhlIGRlZmF1bHQgdmFsdWVzIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgICAgICAgIG1vY2soe1xuICAgICAgICAgICAgICAgICdibGl0ei55bWwnOiBtb2NrLmZpbGUoe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnJyxcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogNzc3LFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsZXQgY29uZmlnID0gQ29uZmlnUGFyc2VyLmxvYWQoJ2JsaXR6LnltbCcpO1xuICAgICAgICAgICAgbW9jay5yZXN0b3JlKCk7XG4gICAgICAgICAgICBsZXQgcHJvcGVydHlDb3VudCA9IENPTkZJR19QUk9QRVJUSUVTLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvcGVydHlDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHByb3BlcnR5ID0gQ09ORklHX1BST1BFUlRJRVNbaV07XG4gICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChjb25maWdbcHJvcGVydHkubmFtZV0sIHByb3BlcnR5LmRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdzaG91bGQgcmVhZCB0aGUgY29uZmlnIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBjb25maWdPYmplY3QgPSB7XG4gICAgICAgICAgICAgICAgYmxpdHpfdmVyc2lvbjogJzkuOS45JyxcbiAgICAgICAgICAgICAgICBnbG9iYWxzOiB7XG4gICAgICAgICAgICAgICAgICAgIGhlbGxvOiAnd29ybGQnLFxuICAgICAgICAgICAgICAgICAgICBpbnRlZ2VyOiAxMjMsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYWdlczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmk6ICcvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnaW5kZXgucHVnJyxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdoZWxwLnB1ZycsXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBtb2NrKHtcbiAgICAgICAgICAgICAgICAnYmxpdHoueW1sJzogbW9jay5maWxlKHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogeWFtbC5zYWZlRHVtcChjb25maWdPYmplY3QpLFxuICAgICAgICAgICAgICAgICAgICBtb2RlOiA3NzcsXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCBjb25maWcgPSBDb25maWdQYXJzZXIubG9hZCgnYmxpdHoueW1sJyk7XG4gICAgICAgICAgICBtb2NrLnJlc3RvcmUoKTtcbiAgICAgICAgICAgIGZvciAobGV0IHByb3BlcnR5TmFtZSBpbiBjb25maWdPYmplY3QpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29uZmlnT2JqZWN0Lmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChjb25maWdbcHJvcGVydHlOYW1lXSwgY29uZmlnT2JqZWN0W3Byb3BlcnR5TmFtZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3Nob3VsZCB0aHJvdyBhbiBlcnJvciB3aGVuIGFuIGluY29ycmVjdCB0eXBlIGZvciBhIHJlcXVpcmVkIHBhcmFtZXRlcnMgaXMgc3VwcGxpZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgcHJvcGVydHlDb3VudCA9IENPTkZJR19QUk9QRVJUSUVTLmxlbmd0aDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcHJvcGVydHlDb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHByb3BlcnR5ID0gQ09ORklHX1BST1BFUlRJRVNbaV07XG4gICAgICAgICAgICAgICAgbGV0IGNvbnRlbnRPYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICBsZXQgYmFkVmFsdWU7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgcHJvcGVydHkuZGVmYXVsdFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgICAgICAgICAgYmFkVmFsdWUgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgYmFkVmFsdWUgPSAnc3RyaW5nJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29udGVudE9iamVjdFtwcm9wZXJ0eS5uYW1lXSA9IGJhZFZhbHVlO1xuICAgICAgICAgICAgICAgIG1vY2soe1xuICAgICAgICAgICAgICAgICAgICAnYmxpdHoueW1sJzogbW9jay5maWxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHlhbWwuc2FmZUR1bXAoY29udGVudE9iamVjdCksXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiA3NzcsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGFzc2VydC50aHJvd3MoKCkgPT4gQ29uZmlnUGFyc2VyLmxvYWQoJ2JsaXR6LnltbCcpLCAnSW52YWxpZCB0eXBlJyk7XG4gICAgICAgICAgICAgICAgbW9jay5yZXN0b3JlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG5cbn0pO1xuIl19
