"use strict";
var StringHelper_1 = require('./helpers/StringHelper');
var Content = (function () {
    function Content() {
    }
    Content.prototype.prepare = function (rawContent) {
        this.urlFunctionMap = {};
        this.assetFunctionMap = {};
        this.ids = [];
        this.assets = [];
        var preparedContent = this.parseFunction(rawContent, 'url', this.urlFunctionMap, this.ids);
        preparedContent = this.parseFunction(preparedContent, 'asset', this.assetFunctionMap, this.assets);
        this.preparedContent = preparedContent;
    };
    Content.prototype.parseFunction = function (content, functionName, map, values) {
        var regex = new RegExp('\\\\?\\$\{' + functionName + '(\|((?!}).)*)?}', 'gi');
        return content.replace(regex, function (match) {
            if (match.substr(0, 1) === '\\') {
                return match.substr(1);
            }
            var token = '<%' + functionName + '-' + StringHelper_1.StringHelper.random(6) + '%>';
            if (match.substr(2 + functionName.length, 1) !== '|') {
                map[token] = undefined;
            }
            else {
                var parameter = match.substr(3 + functionName.length);
                parameter = parameter.substr(0, parameter.length - 1);
                values.push(parameter);
                map[token] = parameter;
            }
            return token;
        });
    };
    Content.prototype.generate = function (urlGenerator, assetPathGenerator, contentParser) {
        if (this.preparedContent === undefined) {
            throw new Error('Cannot generate content with nothing prepared!');
        }
        var content = this.preparedContent;
        for (var urlToken in this.urlFunctionMap) {
            if (this.urlFunctionMap.hasOwnProperty(urlToken)) {
                content = content.replace(urlToken, urlGenerator(this.urlFunctionMap[urlToken]));
            }
        }
        for (var assetToken in this.assetFunctionMap) {
            if (this.assetFunctionMap.hasOwnProperty(assetToken)) {
                content = content.replace(assetToken, assetPathGenerator(this.assetFunctionMap[assetToken]));
            }
        }
        return contentParser(content);
    };
    Content.prototype.getIds = function () {
        return this.ids;
    };
    Content.prototype.getAssets = function () {
        return this.assets;
    };
    return Content;
}());
exports.Content = Content;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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YyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDL0MsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRixDQUFDO1FBQ0wsQ0FBQztRQUNELEdBQUcsQ0FBQyxDQUFDLElBQUksVUFBVSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7WUFDM0MsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ25ELE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pHLENBQUM7UUFDTCxDQUFDO1FBQ0QsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBS00sd0JBQU0sR0FBYjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3BCLENBQUM7SUFLTSwyQkFBUyxHQUFoQjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7SUFDTCxjQUFDO0FBQUQsQ0FqR0EsQUFpR0MsSUFBQTtBQWpHWSxlQUFPLFVBaUduQixDQUFBIiwiZmlsZSI6InNyYy9Db250ZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBBIFR5cGVTY3JpcHQgZmlsZS5cbiAqIEBhdXRob3IgVGltdXIgS3V6aGFnYWxpeWV2IDx0aW0ua3V6aEBnbWFpbC5jb20+XG4gKiBAY29weXJpZ2h0IDIwMTZcbiAqIEBsaWNlbnNlIEdQTC0zLjBcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5cbmltcG9ydCB7SUFzc2V0UGF0aEdlbmVyYXRvciwgSVVybEdlbmVyYXRvciwgQ29udGVudFBhcnNlcn0gZnJvbSAnLi9TaXRlR2VuZXJhdG9yJztcbmltcG9ydCB7U3RyaW5nSGVscGVyfSBmcm9tICcuL2hlbHBlcnMvU3RyaW5nSGVscGVyJztcblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIGZ1bmN0aW9ucyBpbiB0aGUgY29udGVudFxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUNvbnRlbnRGdW5jdGlvbk1hcCB7XG4gICAgW3Rva2VuOiBzdHJpbmddOiBzdHJpbmc7XG59XG5cbi8qKlxuICogQGNsYXNzIERhdGEgdHlwZSBmb3IgdGhlIHByb2Nlc3NlZCBjb250ZW50IG9mIGEgQmxpdHogY29udGVudCBmaWxlXG4gKiBAc2luY2UgMC4yLjBcbiAqL1xuZXhwb3J0IGNsYXNzIENvbnRlbnQge1xuICAgIC8qKlxuICAgICAqIENvbnRlbnQgc3RyaW5nIGFzIGZvdW5kIGluIHRoZSBjb250ZW50IGZpbGVcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIHByZXBhcmVkQ29udGVudDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogTWFwcyBvZiBVUkwgYW5kIEFzc2V0IGZ1bmN0aW9ucyB3aXRoIHRoZWlyIHBhcmFtZXRlcnNcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIHVybEZ1bmN0aW9uTWFwOiBJQ29udGVudEZ1bmN0aW9uTWFwO1xuICAgIHByaXZhdGUgYXNzZXRGdW5jdGlvbk1hcDogSUNvbnRlbnRGdW5jdGlvbk1hcDtcblxuICAgIC8qKlxuICAgICAqIEFycmF5cyBvZiBJRHMgYW5kIGFzc2V0cyByZWZlcmVuY2VkIGluIHRoZSBjb250ZW50XG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBpZHM6IHN0cmluZ1tdO1xuICAgIHByaXZhdGUgYXNzZXRzOiBzdHJpbmdbXTtcblxuICAgIC8qKlxuICAgICAqIEV4dHJhY3RzIGZ1bmN0aW9ucyBmcm9tIHRoZSByYXcgY29udGVudCBzdHJpbmcgYW5kIHJlcGxhY2VzIHRoZW0gd2l0aCB0b2tlbnNcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgcHJlcGFyZShyYXdDb250ZW50OiBzdHJpbmcpIHtcblxuICAgICAgICB0aGlzLnVybEZ1bmN0aW9uTWFwID0ge307XG4gICAgICAgIHRoaXMuYXNzZXRGdW5jdGlvbk1hcCA9IHt9O1xuICAgICAgICB0aGlzLmlkcyA9IFtdO1xuICAgICAgICB0aGlzLmFzc2V0cyA9IFtdO1xuXG4gICAgICAgIGxldCBwcmVwYXJlZENvbnRlbnQgPSB0aGlzLnBhcnNlRnVuY3Rpb24ocmF3Q29udGVudCwgJ3VybCcsIHRoaXMudXJsRnVuY3Rpb25NYXAsIHRoaXMuaWRzKTtcbiAgICAgICAgcHJlcGFyZWRDb250ZW50ID0gdGhpcy5wYXJzZUZ1bmN0aW9uKHByZXBhcmVkQ29udGVudCwgJ2Fzc2V0JywgdGhpcy5hc3NldEZ1bmN0aW9uTWFwLCB0aGlzLmFzc2V0cyk7XG4gICAgICAgIHRoaXMucHJlcGFyZWRDb250ZW50ID0gcHJlcGFyZWRDb250ZW50O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEV4dHJhY3RzIGZ1bmN0aW9uIGZyb20gYSBjb250ZW50IHN0cmluZ1xuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBwYXJzZUZ1bmN0aW9uKGNvbnRlbnQ6IHN0cmluZywgZnVuY3Rpb25OYW1lOiBzdHJpbmcsIG1hcDogSUNvbnRlbnRGdW5jdGlvbk1hcCwgdmFsdWVzOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gICAgICAgIGxldCByZWdleCA9IG5ldyBSZWdFeHAoJ1xcXFxcXFxcP1xcXFwkXFx7JyArIGZ1bmN0aW9uTmFtZSArICcoXFx8KCg/IX0pLikqKT99JywgJ2dpJyk7XG4gICAgICAgIHJldHVybiBjb250ZW50LnJlcGxhY2UocmVnZXgsIChtYXRjaCkgPT4ge1xuICAgICAgICAgICAgaWYgKG1hdGNoLnN1YnN0cigwLCAxKSA9PT0gJ1xcXFwnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLnN1YnN0cigxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCB0b2tlbiA9ICc8JScgKyBmdW5jdGlvbk5hbWUgKyAnLScgKyBTdHJpbmdIZWxwZXIucmFuZG9tKDYpICsgJyU+JztcbiAgICAgICAgICAgIGlmIChtYXRjaC5zdWJzdHIoMiArIGZ1bmN0aW9uTmFtZS5sZW5ndGgsIDEpICE9PSAnfCcpIHtcbiAgICAgICAgICAgICAgICBtYXBbdG9rZW5dID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgcGFyYW1ldGVyID0gbWF0Y2guc3Vic3RyKDMgKyBmdW5jdGlvbk5hbWUubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICBwYXJhbWV0ZXIgPSBwYXJhbWV0ZXIuc3Vic3RyKDAsIHBhcmFtZXRlci5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaChwYXJhbWV0ZXIpO1xuICAgICAgICAgICAgICAgIG1hcFt0b2tlbl0gPSBwYXJhbWV0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdG9rZW47XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRha2VzIHBhcnRpYWxseSBhcHBsaWVkIGdlbmVyYXRvcnMgYW5kIGdlbmVyYXRlcyB0aGUgcGFnZSBjb250ZW50XG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGdlbmVyYXRlKHVybEdlbmVyYXRvcjogSVVybEdlbmVyYXRvcixcbiAgICAgICAgICAgICAgICAgICAgYXNzZXRQYXRoR2VuZXJhdG9yOiBJQXNzZXRQYXRoR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50UGFyc2VyOiBDb250ZW50UGFyc2VyKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMucHJlcGFyZWRDb250ZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGdlbmVyYXRlIGNvbnRlbnQgd2l0aCBub3RoaW5nIHByZXBhcmVkIScpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjb250ZW50ID0gdGhpcy5wcmVwYXJlZENvbnRlbnQ7XG4gICAgICAgIGZvciAobGV0IHVybFRva2VuIGluIHRoaXMudXJsRnVuY3Rpb25NYXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnVybEZ1bmN0aW9uTWFwLmhhc093blByb3BlcnR5KHVybFRva2VuKSkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UodXJsVG9rZW4sIHVybEdlbmVyYXRvcih0aGlzLnVybEZ1bmN0aW9uTWFwW3VybFRva2VuXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGFzc2V0VG9rZW4gaW4gdGhpcy5hc3NldEZ1bmN0aW9uTWFwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hc3NldEZ1bmN0aW9uTWFwLmhhc093blByb3BlcnR5KGFzc2V0VG9rZW4pKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZShhc3NldFRva2VuLCBhc3NldFBhdGhHZW5lcmF0b3IodGhpcy5hc3NldEZ1bmN0aW9uTWFwW2Fzc2V0VG9rZW5dKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRlbnRQYXJzZXIoY29udGVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGdldElkcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0QXNzZXRzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXRzO1xuICAgIH1cbn1cbiJdfQ==
