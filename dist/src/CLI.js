"use strict";
var nomnom = require('nomnom');
var path = require('path');
var ProjectInitialiser_1 = require('./ProjectInitialiser');
var Logger_1 = require('./Logger');
var Blitz_1 = require('./Blitz');
var Config_1 = require('./Config');
var SiteGenerator_1 = require('./SiteGenerator');
var Util_1 = require('./Util');
exports.CLI_NAME = 'blitz';
var CLI = (function () {
    function CLI() {
    }
    CLI.run = function (argv) {
        var parser = nomnom();
        global.debug = false;
        parser.script(exports.CLI_NAME);
        parser.printer(function (message) {
            var strings = Logger_1.Logger.split(message);
            for (var i = 0; i < strings.length; i++) {
                if (strings[i].match(/^command/)) {
                    strings[i] = 'Commands:';
                }
            }
            Logger_1.Logger.logMany(strings);
        });
        parser.nocommand().callback(function () { return CLI.version(); });
        parser.option('debug', {
            abbr: 'd',
            flag: true,
            help: 'displays debug output',
            callback: function (flagSet) { return global.debug = flagSet; },
        });
        parser.command('init')
            .option('template', {
            abbr: 't',
            default: ProjectInitialiser_1.DEFAULT_TEMPLATE,
            help: 'template name',
        })
            .option('path', {
            abbr: 'p',
            default: process.cwd(),
            help: 'path to project folder',
        })
            .help('initialise a project from template')
            .callback(function (opts) { return Blitz_1.Blitz.init(opts.template, opts.path); });
        parser.command('build')
            .option('config', {
            abbr: 'c',
            default: path.join(process.cwd(), Config_1.DEFAULT_CONFIG_NAME),
            help: 'path to Blitz config',
        })
            .option('build', {
            abbr: 'b',
            default: path.join(process.cwd(), SiteGenerator_1.DEFAULT_BUILD_DIRECTORY_NAME),
            help: 'path to target build directory',
        })
            .help('builds site using `blitz.yml`')
            .callback(function (opts) { return Blitz_1.Blitz.build(opts.config, opts.build); });
        parser.command('watch')
            .help('watches source code and rebuilds the website when necessary')
            .callback(function () { return Blitz_1.Blitz.watch(); });
        parser.command('preview')
            .help('starts a web server for real-time change preview')
            .callback(function () { return Blitz_1.Blitz.preview(); });
        var normalisedArgv = argv.slice(2);
        exports.args = parser.parse(normalisedArgv);
    };
    CLI.version = function () {
        Logger_1.Logger.log('Blitz v' + Util_1.Util.getPackageInfo().version + ', use `' + Logger_1.Logger.brand('blitz -h') + '` for help');
        Logger_1.Logger.log('For documentation, refer to ' + Logger_1.Logger.brand('https://getblitz.io/'));
    };
    return CLI;
}());
exports.CLI = CLI;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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eEVZLFdBQUcsTUF3RWYsQ0FBQSIsImZpbGUiOiJzcmMvQ0xJLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBDb250YWlucyBjb2RlIHJlc3BvbnNpYmxlIGZvciByb3V0aW5nIGBibGl0emAgQ0xJIGNvbW1hbmRzIHRvIHRoZSBgYmxpdHpgIG1vZHVsZVxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0ICogYXMgbm9tbm9tIGZyb20gJ25vbW5vbSc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHtERUZBVUxUX1RFTVBMQVRFfSBmcm9tICcuL1Byb2plY3RJbml0aWFsaXNlcic7XG5pbXBvcnQge0xvZ2dlcn0gZnJvbSAnLi9Mb2dnZXInO1xuaW1wb3J0IHtCbGl0en0gZnJvbSAnLi9CbGl0eic7XG5pbXBvcnQge0RFRkFVTFRfQ09ORklHX05BTUV9IGZyb20gJy4vQ29uZmlnJztcbmltcG9ydCB7REVGQVVMVF9CVUlMRF9ESVJFQ1RPUllfTkFNRX0gZnJvbSAnLi9TaXRlR2VuZXJhdG9yJztcbmltcG9ydCB7VXRpbH0gZnJvbSAnLi9VdGlsJztcblxuLyoqXG4gKiBOYW1lIG9mIHRoZSBDTEkgY29tbWFuZCB1c2VkIHRvIHJ1biBCbGl0elxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBjb25zdCBDTElfTkFNRSA9ICdibGl0eic7XG5cbi8qKlxuICogUGFyc2VkIGFyZ3VtZW50c1xuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBsZXQgYXJncztcblxuLyoqXG4gKiBAY2xhc3MgRXhwb3NlcyBhbiBBUEkgZm9yIHRoZSBDTElcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgY2xhc3MgQ0xJIHtcbiAgICAvKipcbiAgICAgKiBQYXJzZXMgY29tbWFuZCBsaW5lIGFyZ3VtZW50cyBhbmQgcnVucyByZWxldmFudCBtZXRob2RzXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHN0YXRpYyBydW4oYXJndjogc3RyaW5nW10pIHtcbiAgICAgICAgbGV0IHBhcnNlciA9IG5vbW5vbSgpO1xuXG4gICAgICAgIGdsb2JhbC5kZWJ1ZyA9IGZhbHNlO1xuXG4gICAgICAgIHBhcnNlci5zY3JpcHQoQ0xJX05BTUUpO1xuICAgICAgICBwYXJzZXIucHJpbnRlcigobWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgbGV0IHN0cmluZ3MgPSBMb2dnZXIuc3BsaXQobWVzc2FnZSk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0cmluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RyaW5nc1tpXS5tYXRjaCgvXmNvbW1hbmQvKSkge1xuICAgICAgICAgICAgICAgICAgICBzdHJpbmdzW2ldID0gJ0NvbW1hbmRzOic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgTG9nZ2VyLmxvZ01hbnkoc3RyaW5ncyk7XG4gICAgICAgIH0pO1xuICAgICAgICBwYXJzZXIubm9jb21tYW5kKCkuY2FsbGJhY2soKCkgPT4gQ0xJLnZlcnNpb24oKSk7XG4gICAgICAgIHBhcnNlci5vcHRpb24oJ2RlYnVnJywge1xuICAgICAgICAgICAgYWJicjogJ2QnLFxuICAgICAgICAgICAgZmxhZzogdHJ1ZSxcbiAgICAgICAgICAgIGhlbHA6ICdkaXNwbGF5cyBkZWJ1ZyBvdXRwdXQnLFxuICAgICAgICAgICAgY2FsbGJhY2s6IChmbGFnU2V0KSA9PiBnbG9iYWwuZGVidWcgPSBmbGFnU2V0LFxuICAgICAgICB9KTtcbiAgICAgICAgcGFyc2VyLmNvbW1hbmQoJ2luaXQnKVxuICAgICAgICAgICAgLm9wdGlvbigndGVtcGxhdGUnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ3QnLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IERFRkFVTFRfVEVNUExBVEUsXG4gICAgICAgICAgICAgICAgaGVscDogJ3RlbXBsYXRlIG5hbWUnLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcHRpb24oJ3BhdGgnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ3AnLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHByb2Nlc3MuY3dkKCksXG4gICAgICAgICAgICAgICAgaGVscDogJ3BhdGggdG8gcHJvamVjdCBmb2xkZXInLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5oZWxwKCdpbml0aWFsaXNlIGEgcHJvamVjdCBmcm9tIHRlbXBsYXRlJylcbiAgICAgICAgICAgIC5jYWxsYmFjaygob3B0cykgPT4gQmxpdHouaW5pdChvcHRzLnRlbXBsYXRlLCBvcHRzLnBhdGgpKTtcbiAgICAgICAgcGFyc2VyLmNvbW1hbmQoJ2J1aWxkJylcbiAgICAgICAgICAgIC5vcHRpb24oJ2NvbmZpZycsIHtcbiAgICAgICAgICAgICAgICBhYmJyOiAnYycsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIERFRkFVTFRfQ09ORklHX05BTUUpLFxuICAgICAgICAgICAgICAgIGhlbHA6ICdwYXRoIHRvIEJsaXR6IGNvbmZpZycsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9wdGlvbignYnVpbGQnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ2InLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBERUZBVUxUX0JVSUxEX0RJUkVDVE9SWV9OQU1FKSxcbiAgICAgICAgICAgICAgICBoZWxwOiAncGF0aCB0byB0YXJnZXQgYnVpbGQgZGlyZWN0b3J5JyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuaGVscCgnYnVpbGRzIHNpdGUgdXNpbmcgYGJsaXR6LnltbGAnKVxuICAgICAgICAgICAgLmNhbGxiYWNrKChvcHRzKSA9PiBCbGl0ei5idWlsZChvcHRzLmNvbmZpZywgb3B0cy5idWlsZCkpO1xuICAgICAgICBwYXJzZXIuY29tbWFuZCgnd2F0Y2gnKVxuICAgICAgICAgICAgLmhlbHAoJ3dhdGNoZXMgc291cmNlIGNvZGUgYW5kIHJlYnVpbGRzIHRoZSB3ZWJzaXRlIHdoZW4gbmVjZXNzYXJ5JylcbiAgICAgICAgICAgIC5jYWxsYmFjaygoKSA9PiBCbGl0ei53YXRjaCgpKTtcbiAgICAgICAgcGFyc2VyLmNvbW1hbmQoJ3ByZXZpZXcnKVxuICAgICAgICAgICAgLmhlbHAoJ3N0YXJ0cyBhIHdlYiBzZXJ2ZXIgZm9yIHJlYWwtdGltZSBjaGFuZ2UgcHJldmlldycpXG4gICAgICAgICAgICAuY2FsbGJhY2soKCkgPT4gQmxpdHoucHJldmlldygpKTtcblxuICAgICAgICBsZXQgbm9ybWFsaXNlZEFyZ3YgPSBhcmd2LnNsaWNlKDIpO1xuICAgICAgICBhcmdzID0gcGFyc2VyLnBhcnNlKG5vcm1hbGlzZWRBcmd2KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmludHMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHZlcnNpb25cbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHZlcnNpb24oKSB7XG4gICAgICAgIExvZ2dlci5sb2coJ0JsaXR6IHYnICsgVXRpbC5nZXRQYWNrYWdlSW5mbygpLnZlcnNpb24gKyAnLCB1c2UgYCcgKyBMb2dnZXIuYnJhbmQoJ2JsaXR6IC1oJykgKyAnYCBmb3IgaGVscCcpO1xuICAgICAgICBMb2dnZXIubG9nKCdGb3IgZG9jdW1lbnRhdGlvbiwgcmVmZXIgdG8gJyArIExvZ2dlci5icmFuZCgnaHR0cHM6Ly9nZXRibGl0ei5pby8nKSk7XG4gICAgfVxufVxuIl19
