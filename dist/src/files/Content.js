"use strict";
var StringHelper_1 = require("../helpers/StringHelper");
var Content = (function () {
    function Content() {
    }
    Content.prototype.prepare = function (rawContent) {
        this.urlFunctionMap = {};
        this.assetFunctionMap = {};
        this.ids = [];
        this.assets = [];
        var preparedContent = this.parseFunction(rawContent, 'url', this.urlFunctionMap, this.ids);
        preparedContent = this.parseFunction(preparedContent, 'asset', this.assetFunctionMap, this.assets);
        this.preparedContent = preparedContent;
    };
    Content.prototype.parseFunction = function (content, functionName, map, values) {
        var regex = new RegExp('\\\\?\\$\{' + functionName + '(\|((?!}).)*)?}', 'gi');
        return content.replace(regex, function (match) {
            if (match.substr(0, 1) === '\\') {
                return match.substr(1);
            }
            var token = '<%' + functionName + '-' + StringHelper_1.StringHelper.random(6) + '%>';
            if (match.substr(2 + functionName.length, 1) !== '|') {
                map[token] = undefined;
            }
            else {
                var parameter = match.substr(3 + functionName.length);
                parameter = parameter.substr(0, parameter.length - 1);
                values.push(parameter);
                map[token] = parameter;
            }
            return token;
        });
    };
    Content.prototype.generate = function (urlGenerator, assetPathGenerator, contentParser) {
        if (this.preparedContent === undefined) {
            throw new Error('Cannot generate content with nothing prepared!');
        }
        var content = this.preparedContent;
        for (var urlToken in this.urlFunctionMap) {
            if (this.urlFunctionMap.hasOwnProperty(urlToken)) {
                content = content.replace(urlToken, urlGenerator(this.urlFunctionMap[urlToken]));
            }
        }
        for (var assetToken in this.assetFunctionMap) {
            if (this.assetFunctionMap.hasOwnProperty(assetToken)) {
                content = content.replace(assetToken, assetPathGenerator(this.assetFunctionMap[assetToken]));
            }
        }
        return contentParser(content);
    };
    Content.prototype.getIds = function () {
        return this.ids;
    };
    Content.prototype.getAssets = function () {
        return this.assets;
    };
    return Content;
}());
exports.Content = Content;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9maWxlcy9Db250ZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFTQSx3REFBcUQ7QUFjckQ7SUFBQTtJQWdHQSxDQUFDO0lBdkVVLHlCQUFPLEdBQWQsVUFBZSxVQUFrQjtRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ2QsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFFakIsSUFBSSxlQUFlLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzNGLGVBQWUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuRyxJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztJQUMzQyxDQUFDO0lBTU0sK0JBQWEsR0FBcEIsVUFBcUIsT0FBZSxFQUFFLFlBQW9CLEVBQUUsR0FBd0IsRUFBRSxNQUFnQjtRQUNsRyxJQUFJLEtBQUssR0FBRyxJQUFJLE1BQU0sQ0FBQyxZQUFZLEdBQUcsWUFBWSxHQUFHLGlCQUFpQixFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzlFLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxVQUFDLEtBQUs7WUFDaEMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDOUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0IsQ0FBQztZQUNELElBQUksS0FBSyxHQUFHLElBQUksR0FBRyxZQUFZLEdBQUcsR0FBRyxHQUFHLDJCQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztZQUN0RSxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ25ELEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxTQUFTLENBQUM7WUFDM0IsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNKLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdEQsU0FBUyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RELE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3ZCLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxTQUFTLENBQUM7WUFDM0IsQ0FBQztZQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBTU0sMEJBQVEsR0FBZixVQUFnQixZQUEyQixFQUMzQixrQkFBdUMsRUFDdkMsYUFBNEI7UUFDeEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sSUFBSSxLQUFLLENBQUMsZ0RBQWdELENBQUMsQ0FBQztRQUN0RSxDQUFDO1FBQ0QsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztRQUNuQyxHQUFHLENBQUMsQ0FBQyxJQUFJLFFBQVEsSUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQy9DLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckYsQ0FBQztRQUNMLENBQUM7UUFDRCxHQUFHLENBQUMsQ0FBQyxJQUFJLFVBQVUsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQzNDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuRCxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqRyxDQUFDO1FBQ0wsQ0FBQztRQUNELE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUtNLHdCQUFNLEdBQWI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNwQixDQUFDO0lBS00sMkJBQVMsR0FBaEI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBQ0wsY0FBQztBQUFELENBaEdBLEFBZ0dDLElBQUE7QUFoR1ksMEJBQU8iLCJmaWxlIjoic3JjL2ZpbGVzL0NvbnRlbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEEgVHlwZVNjcmlwdCBmaWxlLlxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0IHtJQXNzZXRQYXRoR2VuZXJhdG9yLCBJVXJsR2VuZXJhdG9yLCBDb250ZW50UGFyc2VyfSBmcm9tICcuLi9TaXRlR2VuZXJhdG9yJztcbmltcG9ydCB7U3RyaW5nSGVscGVyfSBmcm9tICcuLi9oZWxwZXJzL1N0cmluZ0hlbHBlcic7XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciBmdW5jdGlvbnMgaW4gdGhlIGNvbnRlbnRcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgaW50ZXJmYWNlIElDb250ZW50RnVuY3Rpb25NYXAge1xuICAgIFt0b2tlbjogc3RyaW5nXTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEBjbGFzcyBEYXRhIHR5cGUgZm9yIHRoZSBwcm9jZXNzZWQgY29udGVudCBvZiBhIEJsaXR6IGNvbnRlbnQgZmlsZVxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBjbGFzcyBDb250ZW50IHtcbiAgICAvKipcbiAgICAgKiBDb250ZW50IHN0cmluZyBhcyBmb3VuZCBpbiB0aGUgY29udGVudCBmaWxlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBwcmVwYXJlZENvbnRlbnQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIE1hcHMgb2YgVVJMIGFuZCBBc3NldCBmdW5jdGlvbnMgd2l0aCB0aGVpciBwYXJhbWV0ZXJzXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cmxGdW5jdGlvbk1hcDogSUNvbnRlbnRGdW5jdGlvbk1hcDtcbiAgICBwcml2YXRlIGFzc2V0RnVuY3Rpb25NYXA6IElDb250ZW50RnVuY3Rpb25NYXA7XG5cbiAgICAvKipcbiAgICAgKiBBcnJheXMgb2YgSURzIGFuZCBhc3NldHMgcmVmZXJlbmNlZCBpbiB0aGUgY29udGVudFxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgaWRzOiBzdHJpbmdbXTtcbiAgICBwcml2YXRlIGFzc2V0czogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0cyBmdW5jdGlvbnMgZnJvbSB0aGUgcmF3IGNvbnRlbnQgc3RyaW5nIGFuZCByZXBsYWNlcyB0aGVtIHdpdGggdG9rZW5zXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHByZXBhcmUocmF3Q29udGVudDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudXJsRnVuY3Rpb25NYXAgPSB7fTtcbiAgICAgICAgdGhpcy5hc3NldEZ1bmN0aW9uTWFwID0ge307XG4gICAgICAgIHRoaXMuaWRzID0gW107XG4gICAgICAgIHRoaXMuYXNzZXRzID0gW107XG5cbiAgICAgICAgbGV0IHByZXBhcmVkQ29udGVudCA9IHRoaXMucGFyc2VGdW5jdGlvbihyYXdDb250ZW50LCAndXJsJywgdGhpcy51cmxGdW5jdGlvbk1hcCwgdGhpcy5pZHMpO1xuICAgICAgICBwcmVwYXJlZENvbnRlbnQgPSB0aGlzLnBhcnNlRnVuY3Rpb24ocHJlcGFyZWRDb250ZW50LCAnYXNzZXQnLCB0aGlzLmFzc2V0RnVuY3Rpb25NYXAsIHRoaXMuYXNzZXRzKTtcbiAgICAgICAgdGhpcy5wcmVwYXJlZENvbnRlbnQgPSBwcmVwYXJlZENvbnRlbnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdHMgZnVuY3Rpb24gZnJvbSBhIGNvbnRlbnQgc3RyaW5nXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHBhcnNlRnVuY3Rpb24oY29udGVudDogc3RyaW5nLCBmdW5jdGlvbk5hbWU6IHN0cmluZywgbWFwOiBJQ29udGVudEZ1bmN0aW9uTWFwLCB2YWx1ZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgnXFxcXFxcXFw/XFxcXCRcXHsnICsgZnVuY3Rpb25OYW1lICsgJyhcXHwoKD8hfSkuKSopP30nLCAnZ2knKTtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQucmVwbGFjZShyZWdleCwgKG1hdGNoKSA9PiB7XG4gICAgICAgICAgICBpZiAobWF0Y2guc3Vic3RyKDAsIDEpID09PSAnXFxcXCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc3Vic3RyKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHRva2VuID0gJzwlJyArIGZ1bmN0aW9uTmFtZSArICctJyArIFN0cmluZ0hlbHBlci5yYW5kb20oNikgKyAnJT4nO1xuICAgICAgICAgICAgaWYgKG1hdGNoLnN1YnN0cigyICsgZnVuY3Rpb25OYW1lLmxlbmd0aCwgMSkgIT09ICd8Jykge1xuICAgICAgICAgICAgICAgIG1hcFt0b2tlbl0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBwYXJhbWV0ZXIgPSBtYXRjaC5zdWJzdHIoMyArIGZ1bmN0aW9uTmFtZS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHBhcmFtZXRlciA9IHBhcmFtZXRlci5zdWJzdHIoMCwgcGFyYW1ldGVyLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgbWFwW3Rva2VuXSA9IHBhcmFtZXRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGFrZXMgcGFydGlhbGx5IGFwcGxpZWQgZ2VuZXJhdG9ycyBhbmQgZ2VuZXJhdGVzIHRoZSBwYWdlIGNvbnRlbnRcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2VuZXJhdGUodXJsR2VuZXJhdG9yOiBJVXJsR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBhc3NldFBhdGhHZW5lcmF0b3I6IElBc3NldFBhdGhHZW5lcmF0b3IsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRQYXJzZXI6IENvbnRlbnRQYXJzZXIpOiBzdHJpbmcge1xuICAgICAgICBpZiAodGhpcy5wcmVwYXJlZENvbnRlbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZ2VuZXJhdGUgY29udGVudCB3aXRoIG5vdGhpbmcgcHJlcGFyZWQhJyk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGNvbnRlbnQgPSB0aGlzLnByZXBhcmVkQ29udGVudDtcbiAgICAgICAgZm9yIChsZXQgdXJsVG9rZW4gaW4gdGhpcy51cmxGdW5jdGlvbk1hcCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudXJsRnVuY3Rpb25NYXAuaGFzT3duUHJvcGVydHkodXJsVG9rZW4pKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZSh1cmxUb2tlbiwgdXJsR2VuZXJhdG9yKHRoaXMudXJsRnVuY3Rpb25NYXBbdXJsVG9rZW5dKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgYXNzZXRUb2tlbiBpbiB0aGlzLmFzc2V0RnVuY3Rpb25NYXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFzc2V0RnVuY3Rpb25NYXAuaGFzT3duUHJvcGVydHkoYXNzZXRUb2tlbikpIHtcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKGFzc2V0VG9rZW4sIGFzc2V0UGF0aEdlbmVyYXRvcih0aGlzLmFzc2V0RnVuY3Rpb25NYXBbYXNzZXRUb2tlbl0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29udGVudFBhcnNlcihjb250ZW50KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0SWRzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaWRzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRBc3NldHMoKTogc3RyaW5nW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5hc3NldHM7XG4gICAgfVxufVxuIl19
