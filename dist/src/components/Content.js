"use strict";
var StringHelper_1 = require('../helpers/StringHelper');
var Content = (function () {
    function Content() {
    }
    Content.prototype.prepare = function (rawContent) {
        this.urlFunctionMap = {};
        this.assetFunctionMap = {};
        this.ids = [];
        this.assets = [];
        var preparedContent = this.parseFunction(rawContent, 'url', this.urlFunctionMap, this.ids);
        preparedContent = this.parseFunction(preparedContent, 'asset', this.assetFunctionMap, this.assets);
        this.preparedContent = preparedContent;
    };
    Content.prototype.parseFunction = function (content, functionName, map, values) {
        var regex = new RegExp('\\\\?\\$\{' + functionName + '(\|((?!}).)*)?}', 'gi');
        return content.replace(regex, function (match) {
            if (match.substr(0, 1) === '\\') {
                return match.substr(1);
            }
            var token = '<%' + functionName + '-' + StringHelper_1.StringHelper.randomString(6) + '%>';
            if (match.substr(2 + functionName.length, 1) !== '|') {
                map[token] = undefined;
            }
            else {
                var parameter = match.substr(3 + functionName.length);
                parameter = parameter.substr(0, parameter.length - 1);
                values.push(parameter);
                map[token] = parameter;
            }
            return token;
        });
    };
    Content.prototype.generate = function (urlGenerator, assetPathGenerator, contentParser) {
        if (this.preparedContent === undefined) {
            throw new Error('Cannot generate content with nothing prepared!');
        }
        var content = this.preparedContent;
        for (var urlToken in this.urlFunctionMap) {
            if (this.urlFunctionMap.hasOwnProperty(urlToken)) {
                content = content.replace(urlToken, urlGenerator(this.urlFunctionMap[urlToken]));
            }
        }
        for (var assetToken in this.assetFunctionMap) {
            if (this.assetFunctionMap.hasOwnProperty(assetToken)) {
                content = content.replace(assetToken, assetPathGenerator(this.assetFunctionMap[assetToken]));
            }
        }
        return contentParser(content);
    };
    Content.prototype.getIds = function () {
        return this.ids;
    };
    Content.prototype.getAssets = function () {
        return this.assets;
    };
    return Content;
}());
exports.Content = Content;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL0NvbnRlbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQVFBLDZCQUEyQix5QkFBeUIsQ0FBQyxDQUFBO0FBZXJEO0lBQUE7SUFnR0EsQ0FBQztJQXZFVSx5QkFBTyxHQUFkLFVBQWUsVUFBa0I7UUFDN0IsSUFBSSxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztRQUMzQixJQUFJLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNkLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBRWpCLElBQUksZUFBZSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMzRixlQUFlLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbkcsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7SUFDM0MsQ0FBQztJQU1NLCtCQUFhLEdBQXBCLFVBQXFCLE9BQWUsRUFBRSxZQUFvQixFQUFFLEdBQXdCLEVBQUUsTUFBZ0I7UUFDbEcsSUFBSSxLQUFLLEdBQUcsSUFBSSxNQUFNLENBQUMsWUFBWSxHQUFHLFlBQVksR0FBRyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5RSxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsVUFBQyxLQUFLO1lBQ2hDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLENBQUM7WUFDRCxJQUFJLEtBQUssR0FBRyxJQUFJLEdBQUcsWUFBWSxHQUFHLEdBQUcsR0FBRywyQkFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDNUUsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNuRCxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsU0FBUyxDQUFDO1lBQzNCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDSixJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3RELFNBQVMsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN0RCxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUN2QixHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsU0FBUyxDQUFDO1lBQzNCLENBQUM7WUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQU1NLDBCQUFRLEdBQWYsVUFBZ0IsWUFBMkIsRUFDM0Isa0JBQXVDLEVBQ3ZDLGFBQWdDO1FBQzVDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNyQyxNQUFNLElBQUksS0FBSyxDQUFDLGdEQUFnRCxDQUFDLENBQUM7UUFDdEUsQ0FBQztRQUNELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7UUFDbkMsR0FBRyxDQUFDLENBQUMsSUFBSSxRQUFRLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMvQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JGLENBQUM7UUFDTCxDQUFDO1FBQ0QsR0FBRyxDQUFDLENBQUMsSUFBSSxVQUFVLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUMzQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkQsT0FBTyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBVSxFQUFFLGtCQUFrQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakcsQ0FBQztRQUNMLENBQUM7UUFDRCxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xDLENBQUM7SUFLTSx3QkFBTSxHQUFiO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDcEIsQ0FBQztJQUtNLDJCQUFTLEdBQWhCO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQUNMLGNBQUM7QUFBRCxDQWhHQSxBQWdHQyxJQUFBO0FBaEdZLGVBQU8sVUFnR25CLENBQUEiLCJmaWxlIjoic3JjL2NvbXBvbmVudHMvQ29udGVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQSBUeXBlU2NyaXB0IGZpbGUuXG4gKiBAYXV0aG9yIFRpbXVyIEt1emhhZ2FsaXlldiA8dGltLmt1emhAZ21haWwuY29tPlxuICogQGNvcHlyaWdodCAyMDE2XG4gKiBAbGljZW5zZSBHUEwtMy4wXG4gKiBAc2luY2UgMC4yLjBcbiAqL1xuXG5pbXBvcnQge1N0cmluZ0hlbHBlcn0gZnJvbSAnLi4vaGVscGVycy9TdHJpbmdIZWxwZXInO1xuaW1wb3J0IHtJVXJsR2VuZXJhdG9yLCBJQXNzZXRQYXRoR2VuZXJhdG9yLCBJQ29udGVudEdlbmVyYXRvcn0gZnJvbSAnLi4vY29yZS9Qcm9qZWN0QnVpbGRlcic7XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciBmdW5jdGlvbnMgaW4gdGhlIGNvbnRlbnRcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgaW50ZXJmYWNlIElDb250ZW50RnVuY3Rpb25NYXAge1xuICAgIFt0b2tlbjogc3RyaW5nXTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEBjbGFzcyBEYXRhIHR5cGUgZm9yIHRoZSBwcm9jZXNzZWQgY29udGVudCBvZiBhIEJsaXR6IGNvbnRlbnQgZmlsZVxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBjbGFzcyBDb250ZW50IHtcbiAgICAvKipcbiAgICAgKiBDb250ZW50IHN0cmluZyBhcyBmb3VuZCBpbiB0aGUgY29udGVudCBmaWxlXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBwcmVwYXJlZENvbnRlbnQ6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIE1hcHMgb2YgVVJMIGFuZCBBc3NldCBmdW5jdGlvbnMgd2l0aCB0aGVpciBwYXJhbWV0ZXJzXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSB1cmxGdW5jdGlvbk1hcDogSUNvbnRlbnRGdW5jdGlvbk1hcDtcbiAgICBwcml2YXRlIGFzc2V0RnVuY3Rpb25NYXA6IElDb250ZW50RnVuY3Rpb25NYXA7XG5cbiAgICAvKipcbiAgICAgKiBBcnJheXMgb2YgSURzIGFuZCBhc3NldHMgcmVmZXJlbmNlZCBpbiB0aGUgY29udGVudFxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgaWRzOiBzdHJpbmdbXTtcbiAgICBwcml2YXRlIGFzc2V0czogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0cyBmdW5jdGlvbnMgZnJvbSB0aGUgcmF3IGNvbnRlbnQgc3RyaW5nIGFuZCByZXBsYWNlcyB0aGVtIHdpdGggdG9rZW5zXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHByZXBhcmUocmF3Q29udGVudDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMudXJsRnVuY3Rpb25NYXAgPSB7fTtcbiAgICAgICAgdGhpcy5hc3NldEZ1bmN0aW9uTWFwID0ge307XG4gICAgICAgIHRoaXMuaWRzID0gW107XG4gICAgICAgIHRoaXMuYXNzZXRzID0gW107XG5cbiAgICAgICAgbGV0IHByZXBhcmVkQ29udGVudCA9IHRoaXMucGFyc2VGdW5jdGlvbihyYXdDb250ZW50LCAndXJsJywgdGhpcy51cmxGdW5jdGlvbk1hcCwgdGhpcy5pZHMpO1xuICAgICAgICBwcmVwYXJlZENvbnRlbnQgPSB0aGlzLnBhcnNlRnVuY3Rpb24ocHJlcGFyZWRDb250ZW50LCAnYXNzZXQnLCB0aGlzLmFzc2V0RnVuY3Rpb25NYXAsIHRoaXMuYXNzZXRzKTtcbiAgICAgICAgdGhpcy5wcmVwYXJlZENvbnRlbnQgPSBwcmVwYXJlZENvbnRlbnQ7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0cmFjdHMgZnVuY3Rpb24gZnJvbSBhIGNvbnRlbnQgc3RyaW5nXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIHBhcnNlRnVuY3Rpb24oY29udGVudDogc3RyaW5nLCBmdW5jdGlvbk5hbWU6IHN0cmluZywgbWFwOiBJQ29udGVudEZ1bmN0aW9uTWFwLCB2YWx1ZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgnXFxcXFxcXFw/XFxcXCRcXHsnICsgZnVuY3Rpb25OYW1lICsgJyhcXHwoKD8hfSkuKSopP30nLCAnZ2knKTtcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQucmVwbGFjZShyZWdleCwgKG1hdGNoKSA9PiB7XG4gICAgICAgICAgICBpZiAobWF0Y2guc3Vic3RyKDAsIDEpID09PSAnXFxcXCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guc3Vic3RyKDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IHRva2VuID0gJzwlJyArIGZ1bmN0aW9uTmFtZSArICctJyArIFN0cmluZ0hlbHBlci5yYW5kb21TdHJpbmcoNikgKyAnJT4nO1xuICAgICAgICAgICAgaWYgKG1hdGNoLnN1YnN0cigyICsgZnVuY3Rpb25OYW1lLmxlbmd0aCwgMSkgIT09ICd8Jykge1xuICAgICAgICAgICAgICAgIG1hcFt0b2tlbl0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBwYXJhbWV0ZXIgPSBtYXRjaC5zdWJzdHIoMyArIGZ1bmN0aW9uTmFtZS5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIHBhcmFtZXRlciA9IHBhcmFtZXRlci5zdWJzdHIoMCwgcGFyYW1ldGVyLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHBhcmFtZXRlcik7XG4gICAgICAgICAgICAgICAgbWFwW3Rva2VuXSA9IHBhcmFtZXRlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0b2tlbjtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGFrZXMgcGFydGlhbGx5IGFwcGxpZWQgZ2VuZXJhdG9ycyBhbmQgZ2VuZXJhdGVzIHRoZSBwYWdlIGNvbnRlbnRcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2VuZXJhdGUodXJsR2VuZXJhdG9yOiBJVXJsR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBhc3NldFBhdGhHZW5lcmF0b3I6IElBc3NldFBhdGhHZW5lcmF0b3IsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnRQYXJzZXI6IElDb250ZW50R2VuZXJhdG9yKTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMucHJlcGFyZWRDb250ZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGdlbmVyYXRlIGNvbnRlbnQgd2l0aCBub3RoaW5nIHByZXBhcmVkIScpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBjb250ZW50ID0gdGhpcy5wcmVwYXJlZENvbnRlbnQ7XG4gICAgICAgIGZvciAobGV0IHVybFRva2VuIGluIHRoaXMudXJsRnVuY3Rpb25NYXApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnVybEZ1bmN0aW9uTWFwLmhhc093blByb3BlcnR5KHVybFRva2VuKSkge1xuICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UodXJsVG9rZW4sIHVybEdlbmVyYXRvcih0aGlzLnVybEZ1bmN0aW9uTWFwW3VybFRva2VuXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGFzc2V0VG9rZW4gaW4gdGhpcy5hc3NldEZ1bmN0aW9uTWFwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5hc3NldEZ1bmN0aW9uTWFwLmhhc093blByb3BlcnR5KGFzc2V0VG9rZW4pKSB7XG4gICAgICAgICAgICAgICAgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZShhc3NldFRva2VuLCBhc3NldFBhdGhHZW5lcmF0b3IodGhpcy5hc3NldEZ1bmN0aW9uTWFwW2Fzc2V0VG9rZW5dKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbnRlbnRQYXJzZXIoY29udGVudCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGdldElkcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0QXNzZXRzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXRzO1xuICAgIH1cbn1cbiJdfQ==
