"use strict";
var pug = require("pug");
var objectAssign = require("object-assign");
var Template = (function () {
    function Template() {
    }
    Template.prototype.prepare = function (templateString, locals, menus) {
        this.ids = [];
        this.assets = [];
        this.menus = [];
        this.compiledTemplate = pug.compile(templateString);
        this.extractIdsAndAssets(objectAssign({}, locals, { menus: menus }));
        this.extractMenus(locals, menus);
    };
    Template.prototype.extractIdsAndAssets = function (locals) {
        var extraLocals = {
            url: this.mockGenerator(this.ids),
            asset: this.mockGenerator(this.assets),
        };
        this.compiledTemplate(objectAssign({}, locals, extraLocals));
    };
    Template.prototype.extractMenus = function (locals, menus) {
        for (var menu in menus) {
            if (menus.hasOwnProperty(menu)) {
                var cutMenus = objectAssign({}, menus);
                cutMenus[menu] = undefined;
                try {
                    this.compiledTemplate(objectAssign({}, locals, { menus: cutMenus }));
                }
                catch (exception) {
                    this.menus.push(menu);
                }
            }
        }
    };
    Template.prototype.mockGenerator = function (logArray) {
        return function (value) {
            if (value) {
                logArray.push(value);
            }
            return './some/path';
        };
    };
    Template.prototype.generate = function (locals) {
        if (this.compiledTemplate() === undefined) {
            throw new Error('Cannot generate a page from template with nothing prepared!');
        }
        return this.compiledTemplate(locals);
    };
    Template.prototype.getIds = function () {
        return this.ids;
    };
    Template.prototype.getAssets = function () {
        return this.assets;
    };
    Template.prototype.getMenus = function () {
        return this.menus;
    };
    return Template;
}());
exports.Template = Template;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRzL1RlbXBsYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFRQSx5QkFBMkI7QUFDM0IsNENBQThDO0FBUTlDO0lBQUE7SUF1R0EsQ0FBQztJQXBGVSwwQkFBTyxHQUFkLFVBQWUsY0FBc0IsRUFBRSxNQUFXLEVBQUUsS0FBbUI7UUFDbkUsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDZCxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUVoQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsbUJBQW1CLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBQyxLQUFLLE9BQUEsRUFBQyxDQUFDLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBTU8sc0NBQW1CLEdBQTNCLFVBQTRCLE1BQVc7UUFDbkMsSUFBSSxXQUFXLEdBQUc7WUFDZCxHQUFHLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO1lBQ2pDLEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDekMsQ0FBQztRQUNGLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFNTywrQkFBWSxHQUFwQixVQUFxQixNQUFXLEVBQUUsS0FBbUI7UUFDakQsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNyQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsSUFBSSxRQUFRLEdBQUcsWUFBWSxDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDdkMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQztnQkFDM0IsSUFBSSxDQUFDO29CQUNELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFDLEtBQUssRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZFLENBQUM7Z0JBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDakIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzFCLENBQUM7WUFDTCxDQUFDO1FBQ0wsQ0FBQztJQUNMLENBQUM7SUFNTyxnQ0FBYSxHQUFyQixVQUFzQixRQUFrQjtRQUNwQyxNQUFNLENBQUMsVUFBQyxLQUFjO1lBQ2xCLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN6QixDQUFDO1lBQ0QsTUFBTSxDQUFDLGFBQWEsQ0FBQztRQUN6QixDQUFDLENBQUM7SUFDTixDQUFDO0lBTU0sMkJBQVEsR0FBZixVQUFnQixNQUFZO1FBQ3hCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDeEMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO1FBQ25GLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFLTSx5QkFBTSxHQUFiO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDcEIsQ0FBQztJQUtNLDRCQUFTLEdBQWhCO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQUtNLDJCQUFRLEdBQWY7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDO0lBQ0wsZUFBQztBQUFELENBdkdBLEFBdUdDLElBQUE7QUF2R1ksNEJBQVEiLCJmaWxlIjoic3JjL2NvbXBvbmVudHMvVGVtcGxhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIEFsbCBjb2RlIHJlbGF0ZWQgdG8gdGhlIHJlcHJlc2V0bnRhdGlvbiBvZiBhIHRlbXBsYXRlIGZpbGVcbiAqIEBhdXRob3IgVGltdXIgS3V6aGFnYWxpeWV2IDx0aW0ua3V6aEBnbWFpbC5jb20+XG4gKiBAY29weXJpZ2h0IDIwMTZcbiAqIEBsaWNlbnNlIEdQTC0zLjBcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5cbmltcG9ydCAqIGFzIHB1ZyBmcm9tICdwdWcnO1xuaW1wb3J0ICogYXMgb2JqZWN0QXNzaWduIGZyb20gJ29iamVjdC1hc3NpZ24nO1xuaW1wb3J0IHtJU2l0ZU1lbnVNYXB9IGZyb20gJy4vTWVudSc7XG5cbi8qKlxuICogQGNsYXNzIFdyYXBwZXIgYXJvdW5kIGEgc3BlY2lmaWMgdGVtcGxhdGluZyBlbmdpbmUsIGN1cnJlbnRseSBvbmx5IFB1Z1xuICogQHNpbmNlIDAuMi4wXG4gKlxuICovXG5leHBvcnQgY2xhc3MgVGVtcGxhdGUge1xuICAgIC8qKlxuICAgICAqIENvbXBpbGVkIFB1ZyB0ZW1wbGF0ZVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgY29tcGlsZWRUZW1wbGF0ZTogKGxvY2Fscz86IGFueSkgPT4gc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogQXJyYXlzIG9mIElEcywgYXNzZXRzIGFuZCBtZW51cyByZWZlcmVuY2VkIGluIHRoZSB0ZW1wbGF0ZVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgaWRzOiBzdHJpbmdbXTtcbiAgICBwcml2YXRlIGFzc2V0czogc3RyaW5nW107XG4gICAgcHJpdmF0ZSBtZW51czogc3RyaW5nW107XG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0cyBsaXN0IG9mIHJlZmVyZW5jZWQgSURzLCBhc3NldHMgYW5kIG1lbnVzIGZyb20gdGhlIHRlbXBsYXRlIGFmdGVyIGNvbXBpbGluZyBpdFxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBwcmVwYXJlKHRlbXBsYXRlU3RyaW5nOiBzdHJpbmcsIGxvY2FsczogYW55LCBtZW51czogSVNpdGVNZW51TWFwKSB7XG4gICAgICAgIHRoaXMuaWRzID0gW107XG4gICAgICAgIHRoaXMuYXNzZXRzID0gW107XG4gICAgICAgIHRoaXMubWVudXMgPSBbXTtcblxuICAgICAgICB0aGlzLmNvbXBpbGVkVGVtcGxhdGUgPSBwdWcuY29tcGlsZSh0ZW1wbGF0ZVN0cmluZyk7XG4gICAgICAgIHRoaXMuZXh0cmFjdElkc0FuZEFzc2V0cyhvYmplY3RBc3NpZ24oe30sIGxvY2Fscywge21lbnVzfSkpO1xuICAgICAgICB0aGlzLmV4dHJhY3RNZW51cyhsb2NhbHMsIG1lbnVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0IElEcyBhbmQgYXNzZXRzIGZyb20gYSBjb21waWxlZCB0ZW1wbGF0ZSB1c2luZyBtb2NrIGdlbmVyYXRvcnNcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIGV4dHJhY3RJZHNBbmRBc3NldHMobG9jYWxzOiBhbnkpIHtcbiAgICAgICAgbGV0IGV4dHJhTG9jYWxzID0ge1xuICAgICAgICAgICAgdXJsOiB0aGlzLm1vY2tHZW5lcmF0b3IodGhpcy5pZHMpLFxuICAgICAgICAgICAgYXNzZXQ6IHRoaXMubW9ja0dlbmVyYXRvcih0aGlzLmFzc2V0cyksXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29tcGlsZWRUZW1wbGF0ZShvYmplY3RBc3NpZ24oe30sIGxvY2FscywgZXh0cmFMb2NhbHMpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0cyBtZW51cyByZWZlcmVuY2VkIGluIHRoZSBjb21waWxlZCB0ZW1wbGF0ZVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgZXh0cmFjdE1lbnVzKGxvY2FsczogYW55LCBtZW51czogSVNpdGVNZW51TWFwKSB7XG4gICAgICAgIGZvciAobGV0IG1lbnUgaW4gbWVudXMpIHtcbiAgICAgICAgICAgIGlmIChtZW51cy5oYXNPd25Qcm9wZXJ0eShtZW51KSkge1xuICAgICAgICAgICAgICAgIGxldCBjdXRNZW51cyA9IG9iamVjdEFzc2lnbih7fSwgbWVudXMpO1xuICAgICAgICAgICAgICAgIGN1dE1lbnVzW21lbnVdID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcGlsZWRUZW1wbGF0ZShvYmplY3RBc3NpZ24oe30sIGxvY2Fscywge21lbnVzOiBjdXRNZW51c30pKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tZW51cy5wdXNoKG1lbnUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBtb2NrIHN0cmluZyBnZW5lcmF0b3IgdGhhdCBsb2dzIGNhbGwgcGFyYW1ldGVycyBpbnRvIGFuIGFycmF5XG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBtb2NrR2VuZXJhdG9yKGxvZ0FycmF5OiBzdHJpbmdbXSk6ICh2YWx1ZT86IHN0cmluZykgPT4gc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuICh2YWx1ZT86IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbG9nQXJyYXkucHVzaCh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJy4vc29tZS9wYXRoJztcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZXMgYSBIVE1MIHBhZ2UgZnJvbSB0aGUgdGVtcGxhdGVcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2VuZXJhdGUobG9jYWxzPzogYW55KTogc3RyaW5nIHtcbiAgICAgICAgaWYgKHRoaXMuY29tcGlsZWRUZW1wbGF0ZSgpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGdlbmVyYXRlIGEgcGFnZSBmcm9tIHRlbXBsYXRlIHdpdGggbm90aGluZyBwcmVwYXJlZCEnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jb21waWxlZFRlbXBsYXRlKGxvY2Fscyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHVibGljIGdldElkcygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0QXNzZXRzKCk6IHN0cmluZ1tdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXRzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBnZXRNZW51cygpOiBzdHJpbmdbXSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1lbnVzO1xuICAgIH1cbn1cbiJdfQ==
