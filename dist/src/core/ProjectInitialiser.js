"use strict";
var fse = require("fs-extra");
var path = require("path");
var yesNo = require("yesno");
var Logger_1 = require("../cli/Logger");
var Util_1 = require("../helpers/Util");
exports.DEFAULT_TEMPLATE = 'portfolio';
var ProjectInitialiser = (function () {
    function ProjectInitialiser(projectPath, templatesPath) {
        this.projectPath = projectPath;
        this.templatesPath = templatesPath;
    }
    ProjectInitialiser.prototype.findTemplate = function (templateName) {
        var allTemplates = fse.readdirSync(this.templatesPath);
        if (allTemplates.indexOf(templateName) === -1) {
            throw new Error('Template `' + Logger_1.Logger.brand(templateName) + '` does not exist!');
        }
        return path.join(this.templatesPath, templateName);
    };
    ProjectInitialiser.prepareConfig = function (configPath) {
        var configContents = fse.readFileSync(configPath, 'utf8');
        configContents = configContents.replace(/\$\{BLITZ_VERSION}/g, Util_1.Util.getPackageInfo().version);
        fse.writeFileSync(configPath, configContents);
    };
    ProjectInitialiser.copyTemplate = function (templatePath, targetPath) {
        var templateContents = fse.readdirSync(templatePath);
        for (var i = 0; i < templateContents.length; i++) {
            var templatePart = templateContents[i];
            switch (templatePart) {
                case 'build':
                    continue;
                case 'blitz.yml':
                    var configPath = path.join(targetPath, templatePart);
                    fse.copySync(path.join(templatePath, templatePart), configPath);
                    ProjectInitialiser.prepareConfig(configPath);
                    break;
                default:
                    fse.copySync(path.join(templatePath, templatePart), path.join(targetPath, templatePart));
            }
        }
    };
    ProjectInitialiser.prototype.initialise = function (templateName, callback) {
        var _this = this;
        try {
            var templatePath_1 = this.findTemplate(templateName);
            fse.ensureDirSync(this.projectPath);
            var projectPathContents = fse.readdirSync(this.projectPath);
            if (projectPathContents.length > 0) {
                var question = Logger_1.Logger.log('Target path is not empty. Overwrite files? [y/N]', Logger_1.LogLevel.Warn, false);
                yesNo.ask(question, false, function (answer) {
                    if (answer) {
                        ProjectInitialiser.copyTemplate(templatePath_1, _this.projectPath);
                        return callback();
                    }
                    else {
                        return callback('Initialisation aborted, project path is not empty.');
                    }
                }, ['y'], ['N']);
            }
            else {
                ProjectInitialiser.copyTemplate(templatePath_1, this.projectPath);
                return callback();
            }
        }
        catch (exception) {
            return callback('Could not initialise project: ' + exception.message);
        }
    };
    return ProjectInitialiser;
}());
exports.ProjectInitialiser = ProjectInitialiser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb3JlL1Byb2plY3RJbml0aWFsaXNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBUUEsOEJBQWdDO0FBQ2hDLDJCQUE2QjtBQUM3Qiw2QkFBK0I7QUFDL0Isd0NBQStDO0FBQy9DLHdDQUFxQztBQU14QixRQUFBLGdCQUFnQixHQUFHLFdBQVcsQ0FBQztBQU01QztJQWlCSSw0QkFBbUIsV0FBbUIsRUFBRSxhQUFxQjtRQUN6RCxJQUFJLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMvQixJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztJQUN2QyxDQUFDO0lBTU8seUNBQVksR0FBcEIsVUFBcUIsWUFBb0I7UUFDckMsSUFBSSxZQUFZLEdBQUcsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDdkQsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxZQUFZLEdBQUcsZUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsR0FBRyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3JGLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFNYyxnQ0FBYSxHQUE1QixVQUE2QixVQUFrQjtRQUMzQyxJQUFJLGNBQWMsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMxRCxjQUFjLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxXQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUYsR0FBRyxDQUFDLGFBQWEsQ0FBQyxVQUFVLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDbEQsQ0FB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ci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQ29udGFpbnMgY29kZSByZWxhdGVkIHRvIGluaXRpYWxpc2luZyBvZiBCbGl0eiBwcm9qZWN0cyBmcm9tIHRlbXBsYXRlc1xuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0ICogYXMgZnNlIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyB5ZXNObyBmcm9tICd5ZXNubyc7XG5pbXBvcnQge0xvZ2dlciwgTG9nTGV2ZWx9IGZyb20gJy4uL2NsaS9Mb2dnZXInO1xuaW1wb3J0IHtVdGlsfSBmcm9tICcuLi9oZWxwZXJzL1V0aWwnO1xuXG4vKipcbiAqIFRlbXBsYXRlIHVzZWQgZm9yIHByb2plY3QgaW5pdGlhbGlzYXRpb24gYnkgZGVmYXVsdFxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBjb25zdCBERUZBVUxUX1RFTVBMQVRFID0gJ3BvcnRmb2xpbyc7XG5cbi8qKlxuICogQGNsYXNzIEV4cG9zZXMgQVBJIGZvciBpbml0aWFsaXNpbmcgb2YgYSBCbGl0eiBwcm9qZWN0IGZyb20gYSB0ZW1wbGF0ZVxuICogQHNpbmNlIDAuMi4wXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9qZWN0SW5pdGlhbGlzZXIge1xuICAgIC8qKlxuICAgICAqIERpcmVjdG9yeSBpbiB3aGljaCB0aGUgcHJvamVjdCB3aWxsIGJlIGluaXRpYWxpc2VkLiBDcmVhdGVkIGlmIGl0IGRvZXNuJ3QgZXhpc3QuXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSBwcm9qZWN0UGF0aDogc3RyaW5nO1xuXG4gICAgLyoqXG4gICAgICogRGlyZWN0b3J5IGluIHdoaWNoIGFsbCB0ZW1wbGF0ZXMgYXJlIGxpc3RlZC5cbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIHRlbXBsYXRlc1BhdGg6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIFByb2plY3RJbml0aWFsaXNlciBjb25zdHJ1Y3RvclxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBjb25zdHJ1Y3Rvcihwcm9qZWN0UGF0aDogc3RyaW5nLCB0ZW1wbGF0ZXNQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5wcm9qZWN0UGF0aCA9IHByb2plY3RQYXRoO1xuICAgICAgICB0aGlzLnRlbXBsYXRlc1BhdGggPSB0ZW1wbGF0ZXNQYXRoO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHBhdGggdG8gdGhlIHRlbXBsYXRlIGlmIGl0IGV4aXN0cywgdGhyb3dzIGFuIGVycm9yIG90aGVyd2lzZVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgZmluZFRlbXBsYXRlKHRlbXBsYXRlTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGFsbFRlbXBsYXRlcyA9IGZzZS5yZWFkZGlyU3luYyh0aGlzLnRlbXBsYXRlc1BhdGgpO1xuICAgICAgICBpZiAoYWxsVGVtcGxhdGVzLmluZGV4T2YodGVtcGxhdGVOYW1lKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGVtcGxhdGUgYCcgKyBMb2dnZXIuYnJhbmQodGVtcGxhdGVOYW1lKSArICdgIGRvZXMgbm90IGV4aXN0IScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXRoLmpvaW4odGhpcy50ZW1wbGF0ZXNQYXRoLCB0ZW1wbGF0ZU5hbWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlcGxhY2VzIHZhcmlvdXMga2V5d29yZHMgaW4gdGhlIGNvbmZpZ1xuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIHByZXBhcmVDb25maWcoY29uZmlnUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBjb25maWdDb250ZW50cyA9IGZzZS5yZWFkRmlsZVN5bmMoY29uZmlnUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgY29uZmlnQ29udGVudHMgPSBjb25maWdDb250ZW50cy5yZXBsYWNlKC9cXCRcXHtCTElUWl9WRVJTSU9OfS9nLCBVdGlsLmdldFBhY2thZ2VJbmZvKCkudmVyc2lvbik7XG4gICAgICAgIGZzZS53cml0ZUZpbGVTeW5jKGNvbmZpZ1BhdGgsIGNvbmZpZ0NvbnRlbnRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb3BpZXMgZmlsZXMgZnJvbSBvbmUgZGlyZWN0b3J5IGludG8gYW5vdGhlciwgYWRqdXN0IGNvbnRlbnRzIG9mIGZpbGVzIHdoZXJlIG5lY2Vzc2FyeVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgc3RhdGljIGNvcHlUZW1wbGF0ZSh0ZW1wbGF0ZVBhdGg6IHN0cmluZywgdGFyZ2V0UGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGxldCB0ZW1wbGF0ZUNvbnRlbnRzID0gZnNlLnJlYWRkaXJTeW5jKHRlbXBsYXRlUGF0aCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGVtcGxhdGVDb250ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IHRlbXBsYXRlUGFydCA9IHRlbXBsYXRlQ29udGVudHNbaV07XG4gICAgICAgICAgICBzd2l0Y2ggKHRlbXBsYXRlUGFydCkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ2J1aWxkJzpcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgY2FzZSAnYmxpdHoueW1sJzpcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbmZpZ1BhdGggPSBwYXRoLmpvaW4odGFyZ2V0UGF0aCwgdGVtcGxhdGVQYXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgZnNlLmNvcHlTeW5jKHBhdGguam9pbih0ZW1wbGF0ZVBhdGgsIHRlbXBsYXRlUGFydCksIGNvbmZpZ1BhdGgpO1xuICAgICAgICAgICAgICAgICAgICBQcm9qZWN0SW5pdGlhbGlzZXIucHJlcGFyZUNvbmZpZyhjb25maWdQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgZnNlLmNvcHlTeW5jKHBhdGguam9pbih0ZW1wbGF0ZVBhdGgsIHRlbXBsYXRlUGFydCksIHBhdGguam9pbih0YXJnZXRQYXRoLCB0ZW1wbGF0ZVBhcnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpc2VzIHByb2plY3QgaW4gdGhlIHNwZWNpZmllZCBkaXJlY3RvcnkgdXNpbmcgdGhlIHNwZWNpZmllZCB0ZW1wbGF0ZSAoaWYgaXQgZXhpc3RzKVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBpbml0aWFsaXNlKHRlbXBsYXRlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yPzogc3RyaW5nKSA9PiB2b2lkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgdGVtcGxhdGVQYXRoID0gdGhpcy5maW5kVGVtcGxhdGUodGVtcGxhdGVOYW1lKTtcbiAgICAgICAgICAgIGZzZS5lbnN1cmVEaXJTeW5jKHRoaXMucHJvamVjdFBhdGgpO1xuICAgICAgICAgICAgbGV0IHByb2plY3RQYXRoQ29udGVudHMgPSBmc2UucmVhZGRpclN5bmModGhpcy5wcm9qZWN0UGF0aCk7XG4gICAgICAgICAgICBpZiAocHJvamVjdFBhdGhDb250ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IHF1ZXN0aW9uID0gTG9nZ2VyLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgJ1RhcmdldCBwYXRoIGlzIG5vdCBlbXB0eS4gT3ZlcndyaXRlIGZpbGVzPyBbeS9OXScsXG4gICAgICAgICAgICAgICAgICAgIExvZ0xldmVsLldhcm4sXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgKSBhcyBzdHJpbmc7XG4gICAgICAgICAgICAgICAgeWVzTm8uYXNrKHF1ZXN0aW9uLCBmYWxzZSwgKGFuc3dlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBQcm9qZWN0SW5pdGlhbGlzZXIuY29weVRlbXBsYXRlKHRlbXBsYXRlUGF0aCwgdGhpcy5wcm9qZWN0UGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygnSW5pdGlhbGlzYXRpb24gYWJvcnRlZCwgcHJvamVjdCBwYXRoIGlzIG5vdCBlbXB0eS4nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIFsneSddLCBbJ04nXSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIFByb2plY3RJbml0aWFsaXNlci5jb3B5VGVtcGxhdGUodGVtcGxhdGVQYXRoLCB0aGlzLnByb2plY3RQYXRoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXhjZXB0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soJ0NvdWxkIG5vdCBpbml0aWFsaXNlIHByb2plY3Q6ICcgKyBleGNlcHRpb24ubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=
