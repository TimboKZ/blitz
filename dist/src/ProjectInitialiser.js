"use strict";
var fse = require('fs-extra');
var path = require('path');
var yesNo = require('yesno');
var Logger_1 = require('./Logger');
var Util_1 = require('./Util');
exports.DEFAULT_TEMPLATE = 'portfolio';
var ProjectInitialiser = (function () {
    function ProjectInitialiser(projectPath, templatesPath) {
        this.projectPath = projectPath;
        this.templatesPath = templatesPath;
    }
    ProjectInitialiser.prototype.findTemplate = function (templateName) {
        var allTemplates = fse.readdirSync(this.templatesPath);
        if (allTemplates.indexOf(templateName) === -1) {
            throw new Error('Template `' + Logger_1.Logger.brand(templateName) + '` does not exist!');
        }
        return path.join(this.templatesPath, templateName);
    };
    ProjectInitialiser.prototype.prepareConfig = function (configPath) {
        var configContents = fse.readFileSync(configPath, 'utf8');
        configContents = configContents.replace(/\$\{BLITZ_VERSION}/g, Util_1.Util.getPackageInfo().version);
        fse.writeFileSync(configPath, configContents);
    };
    ProjectInitialiser.prototype.copyTemplate = function (templatePath, targetPath) {
        var templateContents = fse.readdirSync(templatePath);
        for (var i = 0; i < templateContents.length; i++) {
            var templatePart = templateContents[i];
            switch (templatePart) {
                case 'build':
                    continue;
                case 'blitz.yml':
                    var configPath = path.join(targetPath, templatePart);
                    fse.copySync(path.join(templatePath, templatePart), configPath);
                    this.prepareConfig(configPath);
                    break;
                default:
                    fse.copySync(path.join(templatePath, templatePart), path.join(targetPath, templatePart));
            }
        }
    };
    ProjectInitialiser.prototype.initialise = function (templateName, callback) {
        var _this = this;
        try {
            var templatePath_1 = this.findTemplate(templateName);
            fse.ensureDirSync(this.projectPath);
            var projectPathContents = fse.readdirSync(this.projectPath);
            if (projectPathContents.length > 0) {
                var question = Logger_1.Logger.log('Target path is not empty. Overwrite files? [y/N]', Logger_1.LogLevel.Warn, false);
                yesNo.ask(question, false, function (answer) {
                    if (answer) {
                        _this.copyTemplate(templatePath_1, _this.projectPath);
                        return callback();
                    }
                    else {
                        return callback('Initialisation aborted, project path is not empty.');
                    }
                }, ['y'], ['N']);
            }
            else {
                this.copyTemplate(templatePath_1, this.projectPath);
                return callback();
            }
        }
        catch (exception) {
            return callback('Could not initialise project: ' + exception.message);
        }
    };
    return ProjectInitialiser;
}());
exports.ProjectInitialiser = ProjectInitialiser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Qcm9qZWN0SW5pdGlhbGlzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQVFBLElBQVksR0FBRyxXQUFNLFVBQVUsQ0FBQyxDQUFBO0FBQ2hDLElBQVksSUFBSSxXQUFNLE1BQU0sQ0FBQyxDQUFBO0FBQzdCLElBQVksS0FBSyxXQUFNLE9BQU8sQ0FBQyxDQUFBO0FBQy9CLHVCQUErQixVQUFVLENBQUMsQ0FBQTtBQUMxQyxxQkFBbUIsUUFBUSxDQUFDLENBQUE7QUFNZix3QkFBZ0IsR0FBRyxXQUFXLENBQUM7QUFNNUM7SUFpQkksNEJBQW1CLFdBQW1CLEVBQUUsYUFBcUI7UUFDekQsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7SUFDdkMsQ0FBQztJQU1PLHlDQUFZLEdBQXBCLFVBQXFCLFlBQW9CO1FBQ3JDLElBQUksWUFBWSxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3ZELEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sSUFBSSxLQUFLLENBQUMsWUFBWSxHQUFHLGVBQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEdBQUcsbUJBQW1CLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBTU8sMENBQWEsR0FBckIsVUFBc0IsVUFBa0I7UUFDcEMsSUFBSSxjQUFjLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDMUQsY0FBYyxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUMscUJBQXFCLEVBQUUsV0FBSSxDQUFDLGNB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O0lBQ0wseUJBQUM7QUFBRCxDQWpHQSxBQWlHQyxJQUFBO0FBakdZLDBCQUFrQixxQkFpRzlCLENBQUEiLCJmaWxlIjoic3JjL1Byb2plY3RJbml0aWFsaXNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQ29udGFpbnMgY29kZSByZWxhdGVkIHRvIGluaXRpYWxpc2luZyBvZiBCbGl0eiBwcm9qZWN0cyBmcm9tIHRlbXBsYXRlc1xuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMi4wXG4gKi9cblxuaW1wb3J0ICogYXMgZnNlIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyB5ZXNObyBmcm9tICd5ZXNubyc7XG5pbXBvcnQge0xvZ2dlciwgTG9nTGV2ZWx9IGZyb20gJy4vTG9nZ2VyJztcbmltcG9ydCB7VXRpbH0gZnJvbSAnLi9VdGlsJztcblxuLyoqXG4gKiBUZW1wbGF0ZSB1c2VkIGZvciBwcm9qZWN0IGluaXRpYWxpc2F0aW9uIGJ5IGRlZmF1bHRcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9URU1QTEFURSA9ICdwb3J0Zm9saW8nO1xuXG4vKipcbiAqIEBjbGFzcyBFeHBvc2VzIEFQSSBmb3IgaW5pdGlhbGlzaW5nIG9mIGEgQmxpdHogcHJvamVjdCBmcm9tIGEgdGVtcGxhdGVcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgY2xhc3MgUHJvamVjdEluaXRpYWxpc2VyIHtcbiAgICAvKipcbiAgICAgKiBEaXJlY3RvcnkgaW4gd2hpY2ggdGhlIHByb2plY3Qgd2lsbCBiZSBpbml0aWFsaXNlZC4gQ3JlYXRlZCBpZiBpdCBkb2Vzbid0IGV4aXN0LlxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgcHJvamVjdFBhdGg6IHN0cmluZztcblxuICAgIC8qKlxuICAgICAqIERpcmVjdG9yeSBpbiB3aGljaCBhbGwgdGVtcGxhdGVzIGFyZSBsaXN0ZWQuXG4gICAgICogQHNpbmNlIDAuMi4wXG4gICAgICovXG4gICAgcHJpdmF0ZSB0ZW1wbGF0ZXNQYXRoOiBzdHJpbmc7XG5cbiAgICAvKipcbiAgICAgKiBQcm9qZWN0SW5pdGlhbGlzZXIgY29uc3RydWN0b3JcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgY29uc3RydWN0b3IocHJvamVjdFBhdGg6IHN0cmluZywgdGVtcGxhdGVzUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMucHJvamVjdFBhdGggPSBwcm9qZWN0UGF0aDtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZXNQYXRoID0gdGVtcGxhdGVzUGF0aDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBwYXRoIHRvIHRoZSB0ZW1wbGF0ZSBpZiBpdCBleGlzdHMsIHRocm93cyBhbiBlcnJvciBvdGhlcndpc2VcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIGZpbmRUZW1wbGF0ZSh0ZW1wbGF0ZU5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIGxldCBhbGxUZW1wbGF0ZXMgPSBmc2UucmVhZGRpclN5bmModGhpcy50ZW1wbGF0ZXNQYXRoKTtcbiAgICAgICAgaWYgKGFsbFRlbXBsYXRlcy5pbmRleE9mKHRlbXBsYXRlTmFtZSkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RlbXBsYXRlIGAnICsgTG9nZ2VyLmJyYW5kKHRlbXBsYXRlTmFtZSkgKyAnYCBkb2VzIG5vdCBleGlzdCEnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGF0aC5qb2luKHRoaXMudGVtcGxhdGVzUGF0aCwgdGVtcGxhdGVOYW1lKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlcyB2YXJpb3VzIGtleXdvcmRzIGluIHRoZSBjb25maWdcbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwcml2YXRlIHByZXBhcmVDb25maWcoY29uZmlnUGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBjb25maWdDb250ZW50cyA9IGZzZS5yZWFkRmlsZVN5bmMoY29uZmlnUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgY29uZmlnQ29udGVudHMgPSBjb25maWdDb250ZW50cy5yZXBsYWNlKC9cXCRcXHtCTElUWl9WRVJTSU9OfS9nLCBVdGlsLmdldFBhY2thZ2VJbmZvKCkudmVyc2lvbik7XG4gICAgICAgIGZzZS53cml0ZUZpbGVTeW5jKGNvbmZpZ1BhdGgsIGNvbmZpZ0NvbnRlbnRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb3BpZXMgZmlsZXMgZnJvbSBvbmUgZGlyZWN0b3J5IGludG8gYW5vdGhlciwgYWRqdXN0IGNvbnRlbnRzIG9mIGZpbGVzIHdoZXJlIG5lY2Vzc2FyeVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHByaXZhdGUgY29weVRlbXBsYXRlKHRlbXBsYXRlUGF0aDogc3RyaW5nLCB0YXJnZXRQYXRoOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHRlbXBsYXRlQ29udGVudHMgPSBmc2UucmVhZGRpclN5bmModGVtcGxhdGVQYXRoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wbGF0ZUNvbnRlbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgdGVtcGxhdGVQYXJ0ID0gdGVtcGxhdGVDb250ZW50c1tpXTtcbiAgICAgICAgICAgIHN3aXRjaCAodGVtcGxhdGVQYXJ0KSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYnVpbGQnOlxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICBjYXNlICdibGl0ei55bWwnOlxuICAgICAgICAgICAgICAgICAgICBsZXQgY29uZmlnUGF0aCA9IHBhdGguam9pbih0YXJnZXRQYXRoLCB0ZW1wbGF0ZVBhcnQpO1xuICAgICAgICAgICAgICAgICAgICBmc2UuY29weVN5bmMocGF0aC5qb2luKHRlbXBsYXRlUGF0aCwgdGVtcGxhdGVQYXJ0KSwgY29uZmlnUGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJlcGFyZUNvbmZpZyhjb25maWdQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgZnNlLmNvcHlTeW5jKHBhdGguam9pbih0ZW1wbGF0ZVBhdGgsIHRlbXBsYXRlUGFydCksIHBhdGguam9pbih0YXJnZXRQYXRoLCB0ZW1wbGF0ZVBhcnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpc2VzIHByb2plY3QgaW4gdGhlIHNwZWNpZmllZCBkaXJlY3RvcnkgdXNpbmcgdGhlIHNwZWNpZmllZCB0ZW1wbGF0ZSAoaWYgaXQgZXhpc3RzKVxuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBpbml0aWFsaXNlKHRlbXBsYXRlTmFtZTogc3RyaW5nLCBjYWxsYmFjazogKGVycm9yPzogc3RyaW5nKSA9PiB2b2lkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgdGVtcGxhdGVQYXRoID0gdGhpcy5maW5kVGVtcGxhdGUodGVtcGxhdGVOYW1lKTtcbiAgICAgICAgICAgIGZzZS5lbnN1cmVEaXJTeW5jKHRoaXMucHJvamVjdFBhdGgpO1xuICAgICAgICAgICAgbGV0IHByb2plY3RQYXRoQ29udGVudHMgPSBmc2UucmVhZGRpclN5bmModGhpcy5wcm9qZWN0UGF0aCk7XG4gICAgICAgICAgICBpZiAocHJvamVjdFBhdGhDb250ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IHF1ZXN0aW9uID0gTG9nZ2VyLmxvZyhcbiAgICAgICAgICAgICAgICAgICAgJ1RhcmdldCBwYXRoIGlzIG5vdCBlbXB0eS4gT3ZlcndyaXRlIGZpbGVzPyBbeS9OXScsXG4gICAgICAgICAgICAgICAgICAgIExvZ0xldmVsLldhcm4sXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgKSBhcyBzdHJpbmc7XG4gICAgICAgICAgICAgICAgeWVzTm8uYXNrKHF1ZXN0aW9uLCBmYWxzZSwgKGFuc3dlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvcHlUZW1wbGF0ZSh0ZW1wbGF0ZVBhdGgsIHRoaXMucHJvamVjdFBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soJ0luaXRpYWxpc2F0aW9uIGFib3J0ZWQsIHByb2plY3QgcGF0aCBpcyBub3QgZW1wdHkuJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBbJ3knXSwgWydOJ10pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNvcHlUZW1wbGF0ZSh0ZW1wbGF0ZVBhdGgsIHRoaXMucHJvamVjdFBhdGgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChleGNlcHRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygnQ291bGQgbm90IGluaXRpYWxpc2UgcHJvamVjdDogJyArIGV4Y2VwdGlvbi5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
