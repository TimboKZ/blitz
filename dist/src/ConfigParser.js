"use strict";
var Util_1 = require('./Util');
exports.DEFAULT_CONFIG_NAME = 'blitz.yml';
exports.CONFIG_PROPERTIES = [
    {
        name: 'blitz_version',
        message: 'Using current Blitz version',
        defaultValue: Util_1.Util.getPackageInfo().version,
        typeChecker: function (object) { return typeof object === 'string'; },
        typeError: 'Blitz version is supposed to be a string!',
    },
    {
        name: 'site_url',
        message: 'Using an empty string',
        defaultValue: '',
        typeChecker: function (object) { return typeof object === 'string'; },
        typeError: 'Site URL is supposed to be a string!',
    },
    {
        name: 'site_root',
        message: 'Using an empty string',
        defaultValue: '',
        typeChecker: function (object) { return typeof object === 'string'; },
        typeError: 'Site root is supposed to be a string!',
    },
    {
        name: 'absolute_urls',
        message: 'Disabling absolute URLs, using relative URLs instead',
        defaultValue: false,
        typeChecker: function (object) { return typeof object === 'boolean'; },
        typeError: 'Absolute URLs should be a boolean value!',
    },
    {
        name: 'explicit_html_extensions',
        message: 'Enabling explicit HTML extensions',
        defaultValue: true,
        typeChecker: function (object) { return typeof object === 'boolean'; },
        typeError: 'Explicit HTML extensions should be a boolean value!',
    },
    {
        name: 'globals',
        message: 'Assuming there are no globals',
        defaultValue: {},
        typeChecker: function (object) { return typeof object === 'object' && !(object instanceof Array); },
        typeError: 'Globals must be an object (and not an array)!',
    },
    {
        name: 'pages',
        message: 'Assuming there are no pages',
        defaultValue: [],
        typeChecker: function (object) { return typeof object === 'object' && object instanceof Array; },
        typeError: 'Pages must be an array!',
    },
];
var ConfigParser = (function () {
    function ConfigParser() {
    }
    ConfigParser.load = function (configPath) {
        Util_1.Util.debug('Loading Blitz config from `' + configPath + '`...');
        var configContent = Util_1.Util.getFileContents(configPath);
        var config = Util_1.Util.parseYaml(configContent);
        Util_1.Util.debug('Successfully parsed YAML in the config!');
        return this.validate(config);
    };
    ConfigParser.validate = function (config) {
        Util_1.Util.debug('Validating Blitz config...');
        var propertyCount = exports.CONFIG_PROPERTIES.length;
        for (var i = 0; i < propertyCount; i++) {
            var expected = exports.CONFIG_PROPERTIES[i];
            var property = config[expected.name];
            if (property === undefined || property === null) {
                var displayValue = void 0;
                if (typeof expected.defaultValue === 'string') {
                    displayValue = '`' + expected.defaultValue + '`';
                }
                else {
                    displayValue = JSON.stringify(expected.defaultValue);
                }
                var actionString = expected.message + ' (' + displayValue + ')';
                Util_1.Util.warn('`' + expected.name.cyan + '` is not defined: ' + actionString);
                config[expected.name] = expected.defaultValue;
            }
            else if (!expected.typeChecker(property)) {
                var errorString = 'Invalid type for `' + expected.name + '`: ' + expected.typeError;
                throw new Error(errorString);
            }
        }
        Util_1.Util.debug('Successfully validated Blitz config!');
        return config;
    };
    return ConfigParser;
}());
exports.ConfigParser = ConfigParser;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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R0FBRyxvQkFBb0IsR0FBRyxRQUFRLENBQUMsSUFBSSxHQUFHLEtBQUssR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUNwRixNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ2pDLENBQUM7UUFDTCxDQUFDO1FBQ0QsV0FBSSxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUNMLG1CQUFDO0FBQUQsQ0EzQ0EsQUEyQ0MsSUFBQTtBQTNDWSxvQkFBWSxlQTJDeEIsQ0FBQSIsImZpbGUiOiJzcmMvQ29uZmlnUGFyc2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZSBGaWxlIGNvbnRhaW5pbmcgYWxsIGNvbnN0YW50cywgaW50ZXJmYWNlcyBhbmQgY2xhc3NlcyByZWxhdGVkIHRvIEJsaXR6IFlBTUwgY29uZmlnLlxuICogQGF1dGhvciBUaW11ciBLdXpoYWdhbGl5ZXYgPHRpbS5rdXpoQGdtYWlsLmNvbT5cbiAqIEBjb3B5cmlnaHQgMjAxNlxuICogQGxpY2Vuc2UgR1BMLTMuMFxuICogQHNpbmNlIDAuMC4xXG4gKi9cblxuaW1wb3J0IHtVdGlsfSBmcm9tICcuL1V0aWwnO1xuXG4vKipcbiAqIERlZmF1bHQgQmxpdHogY29uZmlnIG5hbWVcbiAqIEBzaW5jZSAwLjAuMVxuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9DT05GSUdfTkFNRSA9ICdibGl0ei55bWwnO1xuXG4vKipcbiAqIEludGVyZmFjZSBmb3IgY2hpbGQgZGlyZWN0b3JpZXMgb2YgdG9wIGxldmVsIHBhZ2VzXG4gKiBAc2luY2UgMC4xLjQgQWRkZWQgYG1lbnVzYFxuICogQHNpbmNlIDAuMS4wIE1hZGUgYHRlbXBsYXRlYCBvcHRpb25hbFxuICogQHNpbmNlIDAuMC4xXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUJsaXR6Q2hpbGREaXJlY3Rvcnkge1xuICAgIHVyaT86IHN0cmluZztcbiAgICB1cmlfa2V5Pzogc3RyaW5nO1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBtZW51czogSUJsaXR6TWVudVtdO1xuICAgIHRlbXBsYXRlPzogc3RyaW5nO1xuICAgIGRpcmVjdG9yeTogc3RyaW5nO1xufVxuXG4vKipcbiAqIE1lbnUgYXMgc2hvdyBpbiB0aGUgY29uZmlnXG4gKiBAc2luY2UgMC4wLjFcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJQmxpdHpNZW51IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgdGl0bGU/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciBjaGlsZCBwYWdlcyBvZiB0b3AgbGV2ZWwgcGFnZXNcbiAqIEBzaW5jZSAwLjAuMVxuICovXG5leHBvcnQgaW50ZXJmYWNlIElCbGl0elBhZ2Uge1xuICAgIHVyaT86IHN0cmluZztcbiAgICBpZD86IHN0cmluZztcbiAgICBuYW1lPzogc3RyaW5nO1xuICAgIHRlbXBsYXRlOiBzdHJpbmc7XG4gICAgY29udGVudD86IHN0cmluZ3xhbnk7XG4gICAgbWVudXM/OiBJQmxpdHpNZW51W107XG4gICAgY2hpbGRfcGFnZXM/OiBJQmxpdHpQYWdlW107XG4gICAgY2hpbGRfZGlyZWN0b3JpZXM/OiBJQmxpdHpDaGlsZERpcmVjdG9yeVtdO1xufVxuXG4vKipcbiAqIE1haW4gQmxpdHogY29uZmlnIGludGVyZmFjZVxuICogQHNpbmNlIDAuMC4xXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSUJsaXR6Q29uZmlnIHtcbiAgICBibGl0el92ZXJzaW9uOiBzdHJpbmc7XG4gICAgc2l0ZV91cmw6IHN0cmluZztcbiAgICBzaXRlX3Jvb3Q6IHN0cmluZztcbiAgICBhYnNvbHV0ZV91cmxzOiBib29sZWFuO1xuICAgIGV4cGxpY2l0X2h0bWxfZXh0ZW5zaW9uczogYm9vbGVhbjtcbiAgICBnbG9iYWxzOiBhbnk7XG4gICAgcGFnZXM6IElCbGl0elBhZ2VbXTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2VzIGZvciB0aGUgY29uZmlnIHZhbGlkYXRpb24gb2JqZWN0XG4gKiBAc2luY2UgMC4xLjNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJQ29uZmlnVmFsaWRhdG9yUHJvcGVydHkge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgZGVmYXVsdFZhbHVlOiBhbnk7XG4gICAgdHlwZUNoZWNrZXI6IChvYmplY3Q6IGFueSkgPT4gYm9vbGVhbjtcbiAgICB0eXBlRXJyb3I6IHN0cmluZztcbn1cblxuLyoqXG4gKiBBcnJheSBvZiBkZWZhdWx0IGNvbmZpZyBwcm9wZXJ0aWVzLlxuICogQHNpbmNlIDAuMS4zXG4gKi9cbmV4cG9ydCBjb25zdCBDT05GSUdfUFJPUEVSVElFUzogSUNvbmZpZ1ZhbGlkYXRvclByb3BlcnR5W10gPSBbXG4gICAge1xuICAgICAgICBuYW1lOiAnYmxpdHpfdmVyc2lvbicsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2luZyBjdXJyZW50IEJsaXR6IHZlcnNpb24nLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IFV0aWwuZ2V0UGFja2FnZUluZm8oKS52ZXJzaW9uLFxuICAgICAgICB0eXBlQ2hlY2tlcjogKG9iamVjdCkgPT4gdHlwZW9mIG9iamVjdCA9PT0gJ3N0cmluZycsXG4gICAgICAgIHR5cGVFcnJvcjogJ0JsaXR6IHZlcnNpb24gaXMgc3VwcG9zZWQgdG8gYmUgYSBzdHJpbmchJyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ3NpdGVfdXJsJyxcbiAgICAgICAgbWVzc2FnZTogJ1VzaW5nIGFuIGVtcHR5IHN0cmluZycsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogJycsXG4gICAgICAgIHR5cGVDaGVja2VyOiAob2JqZWN0KSA9PiB0eXBlb2Ygb2JqZWN0ID09PSAnc3RyaW5nJyxcbiAgICAgICAgdHlwZUVycm9yOiAnU2l0ZSBVUkwgaXMgc3VwcG9zZWQgdG8gYmUgYSBzdHJpbmchJyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ3NpdGVfcm9vdCcsXG4gICAgICAgIG1lc3NhZ2U6ICdVc2luZyBhbiBlbXB0eSBzdHJpbmcnLFxuICAgICAgICBkZWZhdWx0VmFsdWU6ICcnLFxuICAgICAgICB0eXBlQ2hlY2tlcjogKG9iamVjdCkgPT4gdHlwZW9mIG9iamVjdCA9PT0gJ3N0cmluZycsXG4gICAgICAgIHR5cGVFcnJvcjogJ1NpdGUgcm9vdCBpcyBzdXBwb3NlZCB0byBiZSBhIHN0cmluZyEnLFxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAnYWJzb2x1dGVfdXJscycsXG4gICAgICAgIG1lc3NhZ2U6ICdEaXNhYmxpbmcgYWJzb2x1dGUgVVJMcywgdXNpbmcgcmVsYXRpdmUgVVJMcyBpbnN0ZWFkJyxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiBmYWxzZSxcbiAgICAgICAgdHlwZUNoZWNrZXI6IChvYmplY3QpID0+IHR5cGVvZiBvYmplY3QgPT09ICdib29sZWFuJyxcbiAgICAgICAgdHlwZUVycm9yOiAnQWJzb2x1dGUgVVJMcyBzaG91bGQgYmUgYSBib29sZWFuIHZhbHVlIScsXG4gICAgfSxcbiAgICB7XG4gICAgICAgIG5hbWU6ICdleHBsaWNpdF9odG1sX2V4dGVuc2lvbnMnLFxuICAgICAgICBtZXNzYWdlOiAnRW5hYmxpbmcgZXhwbGljaXQgSFRNTCBleHRlbnNpb25zJyxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgICAgICB0eXBlQ2hlY2tlcjogKG9iamVjdCkgPT4gdHlwZW9mIG9iamVjdCA9PT0gJ2Jvb2xlYW4nLFxuICAgICAgICB0eXBlRXJyb3I6ICdFeHBsaWNpdCBIVE1MIGV4dGVuc2lvbnMgc2hvdWxkIGJlIGEgYm9vbGVhbiB2YWx1ZSEnLFxuICAgIH0sXG4gICAge1xuICAgICAgICBuYW1lOiAnZ2xvYmFscycsXG4gICAgICAgIG1lc3NhZ2U6ICdBc3N1bWluZyB0aGVyZSBhcmUgbm8gZ2xvYmFscycsXG4gICAgICAgIGRlZmF1bHRWYWx1ZToge30sXG4gICAgICAgIHR5cGVDaGVja2VyOiAob2JqZWN0KSA9PiB0eXBlb2Ygb2JqZWN0ID09PSAnb2JqZWN0JyAmJiAhKG9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSxcbiAgICAgICAgdHlwZUVycm9yOiAnR2xvYmFscyBtdXN0IGJlIGFuIG9iamVjdCAoYW5kIG5vdCBhbiBhcnJheSkhJyxcbiAgICB9LFxuICAgIHtcbiAgICAgICAgbmFtZTogJ3BhZ2VzJyxcbiAgICAgICAgbWVzc2FnZTogJ0Fzc3VtaW5nIHRoZXJlIGFyZSBubyBwYWdlcycsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogW10sXG4gICAgICAgIHR5cGVDaGVja2VyOiAob2JqZWN0KSA9PiB0eXBlb2Ygb2JqZWN0ID09PSAnb2JqZWN0JyAmJiBvYmplY3QgaW5zdGFuY2VvZiBBcnJheSxcbiAgICAgICAgdHlwZUVycm9yOiAnUGFnZXMgbXVzdCBiZSBhbiBhcnJheSEnLFxuICAgIH0sXG5dO1xuXG4vKipcbiAqIEBjbGFzcyBDbGFzcyByZXNwb25zaWJsZSBmb3IgdmFyaW91cyBvcGVyYXRpb25zIHdpdGggdGhlIGNvbmZpZ1xuICogQHNpbmNlIDAuMC4xXG4gKi9cbmV4cG9ydCBjbGFzcyBDb25maWdQYXJzZXIge1xuICAgIC8qKlxuICAgICAqIExvYWRzIFlBTUwgY29uZmlnIGZyb20gc3BlY2lmaWVkIHBhdGggYW5kIHZlcmlmaWVzIHRoYXQgaXQgaXMgYSB2YWxpZCBCbHRpeiBjb25maWcsIGNyZWF0aW5nIHJlcXVpcmVkIHByb3BlcnRpZXNcbiAgICAgKiB3aGVyZSBwb3NzaWJsZS5cbiAgICAgKiBAc2luY2UgMC4wLjFcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIGxvYWQoY29uZmlnUGF0aDogc3RyaW5nKTogSUJsaXR6Q29uZmlnIHtcbiAgICAgICAgVXRpbC5kZWJ1ZygnTG9hZGluZyBCbGl0eiBjb25maWcgZnJvbSBgJyArIGNvbmZpZ1BhdGggKyAnYC4uLicpO1xuICAgICAgICBsZXQgY29uZmlnQ29udGVudCA9IFV0aWwuZ2V0RmlsZUNvbnRlbnRzKGNvbmZpZ1BhdGgpO1xuICAgICAgICBsZXQgY29uZmlnID0gVXRpbC5wYXJzZVlhbWwoY29uZmlnQ29udGVudCk7XG4gICAgICAgIFV0aWwuZGVidWcoJ1N1Y2Nlc3NmdWxseSBwYXJzZWQgWUFNTCBpbiB0aGUgY29uZmlnIScpO1xuICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZShjb25maWcpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlcyBCbGl0eiBjb25maWcsIGNyZWF0aW5nIHJlcXVpcmVkIHByb3BlcnRpZXMgZnJvbSBkZWZhdWx0IHZhbHVlcyB3aGVyZSBwb3NzaWJsZVxuICAgICAqIEBzaW5jZSAwLjEuNCBOb3cgYWxzbyBjaGVja3MgZm9yIGBudWxsYCBhcyB3ZWxsIGFzIGB1bmRlZmluZWRgXG4gICAgICogQHNpbmNlIDAuMS4zXG4gICAgICovXG4gICAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGUoY29uZmlnOiBhbnkpOiBJQmxpdHpDb25maWcge1xuICAgICAgICBVdGlsLmRlYnVnKCdWYWxpZGF0aW5nIEJsaXR6IGNvbmZpZy4uLicpO1xuICAgICAgICBsZXQgcHJvcGVydHlDb3VudCA9IENPTkZJR19QUk9QRVJUSUVTLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcm9wZXJ0eUNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIGxldCBleHBlY3RlZCA9IENPTkZJR19QUk9QRVJUSUVTW2ldO1xuICAgICAgICAgICAgbGV0IHByb3BlcnR5ID0gY29uZmlnW2V4cGVjdGVkLm5hbWVdO1xuICAgICAgICAgICAgaWYgKHByb3BlcnR5ID09PSB1bmRlZmluZWQgfHwgcHJvcGVydHkgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBsZXQgZGlzcGxheVZhbHVlO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXhwZWN0ZWQuZGVmYXVsdFZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VmFsdWUgPSAnYCcgKyBleHBlY3RlZC5kZWZhdWx0VmFsdWUgKyAnYCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGxheVZhbHVlID0gSlNPTi5zdHJpbmdpZnkoZXhwZWN0ZWQuZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbGV0IGFjdGlvblN0cmluZyA9IGV4cGVjdGVkLm1lc3NhZ2UgKyAnICgnICsgZGlzcGxheVZhbHVlICsgJyknO1xuICAgICAgICAgICAgICAgIFV0aWwud2FybignYCcgKyBleHBlY3RlZC5uYW1lLmN5YW4gKyAnYCBpcyBub3QgZGVmaW5lZDogJyArIGFjdGlvblN0cmluZyk7XG4gICAgICAgICAgICAgICAgY29uZmlnW2V4cGVjdGVkLm5hbWVdID0gZXhwZWN0ZWQuZGVmYXVsdFZhbHVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICghZXhwZWN0ZWQudHlwZUNoZWNrZXIocHJvcGVydHkpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGVycm9yU3RyaW5nID0gJ0ludmFsaWQgdHlwZSBmb3IgYCcgKyBleHBlY3RlZC5uYW1lICsgJ2A6ICcgKyBleHBlY3RlZC50eXBlRXJyb3I7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yU3RyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBVdGlsLmRlYnVnKCdTdWNjZXNzZnVsbHkgdmFsaWRhdGVkIEJsaXR6IGNvbmZpZyEnKTtcbiAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICB9XG59XG4iXX0=
