"use strict";
var nomnom = require('nomnom');
var path = require('path');
var ProjectInitialiser_1 = require('./ProjectInitialiser');
var Logger_1 = require('./Logger');
var Blitz_1 = require('./Blitz');
var Config_1 = require('./Config');
var SiteGenerator_1 = require('./SiteGenerator');
var Util_1 = require('./Util');
exports.CLI_NAME = 'blitz';
var CLI = (function () {
    function CLI() {
    }
    CLI.run = function (argv) {
        var parser = nomnom();
        global.debug = false;
        global.verbose = false;
        parser.script(exports.CLI_NAME);
        parser.printer(function (message) {
            var strings = Logger_1.Logger.split(message);
            var verboseState = global.verbose;
            if (strings[0].substr(0, 5) === 'Usage' || strings[0].substr(0, 5) === 'blitz') {
                global.verbose = true;
            }
            for (var i = 0; i < strings.length; i++) {
                if (strings[i].match(/^command/)) {
                    strings[i] = 'Commands:';
                }
            }
            Logger_1.Logger.logMany(strings);
            global.verbose = verboseState;
        });
        parser.nocommand().callback(function () { return CLI.version(); });
        parser.option('verbose', {
            abbr: 'v',
            flag: true,
            help: 'displays warnings and log output',
            callback: function (flagSet) { return global.verbose = flagSet; },
        });
        parser.option('debug', {
            abbr: 'd',
            flag: true,
            help: 'displays debug output',
            callback: function (flagSet) { return global.debug = flagSet; },
        });
        parser.command('init')
            .option('template', {
            abbr: 't',
            default: ProjectInitialiser_1.DEFAULT_TEMPLATE,
            help: 'template name',
        })
            .option('path', {
            abbr: 'p',
            default: process.cwd(),
            help: 'path to project folder',
        })
            .help('initialise a project from template')
            .callback(function (opts) { return Blitz_1.Blitz.init(opts.template, opts.path); });
        parser.command('build')
            .option('config', {
            abbr: 'c',
            default: path.join(process.cwd(), Config_1.DEFAULT_CONFIG_NAME),
            help: 'path to Blitz config',
        })
            .option('build', {
            abbr: 'b',
            default: path.join(process.cwd(), SiteGenerator_1.DEFAULT_BUILD_DIRECTORY_NAME),
            help: 'path to target build directory',
        })
            .help('builds site using `blitz.yml`')
            .callback(function (opts) { return Blitz_1.Blitz.build(opts.config, opts.build); });
        parser.command('watch')
            .option('config', {
            abbr: 'c',
            default: path.join(process.cwd(), Config_1.DEFAULT_CONFIG_NAME),
            help: 'path to Blitz config',
        })
            .option('build', {
            abbr: 'b',
            default: path.join(process.cwd(), SiteGenerator_1.DEFAULT_BUILD_DIRECTORY_NAME),
            help: 'path to target build directory',
        })
            .help('watches source code and rebuilds the website when necessary')
            .callback(function (opts) { return Blitz_1.Blitz.watch(opts.config, opts.build); });
        parser.command('preview')
            .help('starts a web server for real-time change preview')
            .callback(function () { return Blitz_1.Blitz.preview(); });
        var normalisedArgv = argv.slice(2);
        exports.args = parser.parse(normalisedArgv);
    };
    CLI.version = function () {
        var verboseState = global.verbose;
        global.verbose = true;
        Logger_1.Logger.log('Blitz v' + Util_1.Util.getPackageInfo().version + ', use `' + Logger_1.Logger.brand('blitz -h') + '` for help');
        Logger_1.Logger.log('For documentation, refer to ' + Logger_1.Logger.brand('https://getblitz.io/'));
        global.verbose = verboseState;
    };
    return CLI;
}());
exports.CLI = CLI;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDO1FBQ2xGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsWUFBWSxDQUFDO0lBQ2xDLENBQUM7SUFDTCxVQUFDO0FBQUQsQ0FqR0EsQUFpR0MsSUFBQTtBQWpHWSxXQUFHLE1BaUdmLENBQUEiLCJmaWxlIjoic3JjL0NMSS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgQ29udGFpbnMgY29kZSByZXNwb25zaWJsZSBmb3Igcm91dGluZyBgYmxpdHpgIENMSSBjb21tYW5kcyB0byB0aGUgYGJsaXR6YCBtb2R1bGVcbiAqIEBhdXRob3IgVGltdXIgS3V6aGFnYWxpeWV2IDx0aW0ua3V6aEBnbWFpbC5jb20+XG4gKiBAY29weXJpZ2h0IDIwMTZcbiAqIEBsaWNlbnNlIEdQTC0zLjBcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5cbmltcG9ydCAqIGFzIG5vbW5vbSBmcm9tICdub21ub20nO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7REVGQVVMVF9URU1QTEFURX0gZnJvbSAnLi9Qcm9qZWN0SW5pdGlhbGlzZXInO1xuaW1wb3J0IHtMb2dnZXJ9IGZyb20gJy4vTG9nZ2VyJztcbmltcG9ydCB7QmxpdHp9IGZyb20gJy4vQmxpdHonO1xuaW1wb3J0IHtERUZBVUxUX0NPTkZJR19OQU1FfSBmcm9tICcuL0NvbmZpZyc7XG5pbXBvcnQge0RFRkFVTFRfQlVJTERfRElSRUNUT1JZX05BTUV9IGZyb20gJy4vU2l0ZUdlbmVyYXRvcic7XG5pbXBvcnQge1V0aWx9IGZyb20gJy4vVXRpbCc7XG5cbi8qKlxuICogTmFtZSBvZiB0aGUgQ0xJIGNvbW1hbmQgdXNlZCB0byBydW4gQmxpdHpcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgY29uc3QgQ0xJX05BTUUgPSAnYmxpdHonO1xuXG4vKipcbiAqIFBhcnNlZCBhcmd1bWVudHNcbiAqIEBzaW5jZSAwLjIuMFxuICovXG5leHBvcnQgbGV0IGFyZ3M7XG5cbi8qKlxuICogQGNsYXNzIEV4cG9zZXMgYW4gQVBJIGZvciB0aGUgQ0xJXG4gKiBAc2luY2UgMC4yLjBcbiAqL1xuZXhwb3J0IGNsYXNzIENMSSB7XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGNvbW1hbmQgbGluZSBhcmd1bWVudHMgYW5kIHJ1bnMgcmVsZXZhbnQgbWV0aG9kc1xuICAgICAqIEBzaW5jZSAwLjIuMFxuICAgICAqL1xuICAgIHB1YmxpYyBzdGF0aWMgcnVuKGFyZ3Y6IHN0cmluZ1tdKSB7XG4gICAgICAgIGxldCBwYXJzZXIgPSBub21ub20oKTtcblxuICAgICAgICBnbG9iYWwuZGVidWcgPSBmYWxzZTtcbiAgICAgICAgZ2xvYmFsLnZlcmJvc2UgPSBmYWxzZTtcblxuICAgICAgICBwYXJzZXIuc2NyaXB0KENMSV9OQU1FKTtcbiAgICAgICAgcGFyc2VyLnByaW50ZXIoKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgIGxldCBzdHJpbmdzID0gTG9nZ2VyLnNwbGl0KG1lc3NhZ2UpO1xuICAgICAgICAgICAgbGV0IHZlcmJvc2VTdGF0ZSA9IGdsb2JhbC52ZXJib3NlO1xuICAgICAgICAgICAgaWYgKHN0cmluZ3NbMF0uc3Vic3RyKDAsIDUpID09PSAnVXNhZ2UnIHx8IHN0cmluZ3NbMF0uc3Vic3RyKDAsIDUpID09PSAnYmxpdHonKSB7XG4gICAgICAgICAgICAgICAgZ2xvYmFsLnZlcmJvc2UgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHJpbmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0cmluZ3NbaV0ubWF0Y2goL15jb21tYW5kLykpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RyaW5nc1tpXSA9ICdDb21tYW5kczonO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIExvZ2dlci5sb2dNYW55KHN0cmluZ3MpO1xuICAgICAgICAgICAgZ2xvYmFsLnZlcmJvc2UgPSB2ZXJib3NlU3RhdGU7XG4gICAgICAgIH0pO1xuICAgICAgICBwYXJzZXIubm9jb21tYW5kKCkuY2FsbGJhY2soKCkgPT4gQ0xJLnZlcnNpb24oKSk7XG4gICAgICAgIHBhcnNlci5vcHRpb24oJ3ZlcmJvc2UnLCB7XG4gICAgICAgICAgICBhYmJyOiAndicsXG4gICAgICAgICAgICBmbGFnOiB0cnVlLFxuICAgICAgICAgICAgaGVscDogJ2Rpc3BsYXlzIHdhcm5pbmdzIGFuZCBsb2cgb3V0cHV0JyxcbiAgICAgICAgICAgIGNhbGxiYWNrOiAoZmxhZ1NldCkgPT4gZ2xvYmFsLnZlcmJvc2UgPSBmbGFnU2V0LFxuICAgICAgICB9KTtcbiAgICAgICAgcGFyc2VyLm9wdGlvbignZGVidWcnLCB7XG4gICAgICAgICAgICBhYmJyOiAnZCcsXG4gICAgICAgICAgICBmbGFnOiB0cnVlLFxuICAgICAgICAgICAgaGVscDogJ2Rpc3BsYXlzIGRlYnVnIG91dHB1dCcsXG4gICAgICAgICAgICBjYWxsYmFjazogKGZsYWdTZXQpID0+IGdsb2JhbC5kZWJ1ZyA9IGZsYWdTZXQsXG4gICAgICAgIH0pO1xuICAgICAgICBwYXJzZXIuY29tbWFuZCgnaW5pdCcpXG4gICAgICAgICAgICAub3B0aW9uKCd0ZW1wbGF0ZScsIHtcbiAgICAgICAgICAgICAgICBhYmJyOiAndCcsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogREVGQVVMVF9URU1QTEFURSxcbiAgICAgICAgICAgICAgICBoZWxwOiAndGVtcGxhdGUgbmFtZScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLm9wdGlvbigncGF0aCcsIHtcbiAgICAgICAgICAgICAgICBhYmJyOiAncCcsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcHJvY2Vzcy5jd2QoKSxcbiAgICAgICAgICAgICAgICBoZWxwOiAncGF0aCB0byBwcm9qZWN0IGZvbGRlcicsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmhlbHAoJ2luaXRpYWxpc2UgYSBwcm9qZWN0IGZyb20gdGVtcGxhdGUnKVxuICAgICAgICAgICAgLmNhbGxiYWNrKChvcHRzKSA9PiBCbGl0ei5pbml0KG9wdHMudGVtcGxhdGUsIG9wdHMucGF0aCkpO1xuICAgICAgICBwYXJzZXIuY29tbWFuZCgnYnVpbGQnKVxuICAgICAgICAgICAgLm9wdGlvbignY29uZmlnJywge1xuICAgICAgICAgICAgICAgIGFiYnI6ICdjJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgREVGQVVMVF9DT05GSUdfTkFNRSksXG4gICAgICAgICAgICAgICAgaGVscDogJ3BhdGggdG8gQmxpdHogY29uZmlnJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAub3B0aW9uKCdidWlsZCcsIHtcbiAgICAgICAgICAgICAgICBhYmJyOiAnYicsXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIERFRkFVTFRfQlVJTERfRElSRUNUT1JZX05BTUUpLFxuICAgICAgICAgICAgICAgIGhlbHA6ICdwYXRoIHRvIHRhcmdldCBidWlsZCBkaXJlY3RvcnknLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5oZWxwKCdidWlsZHMgc2l0ZSB1c2luZyBgYmxpdHoueW1sYCcpXG4gICAgICAgICAgICAuY2FsbGJhY2soKG9wdHMpID0+IEJsaXR6LmJ1aWxkKG9wdHMuY29uZmlnLCBvcHRzLmJ1aWxkKSk7XG4gICAgICAgIHBhcnNlci5jb21tYW5kKCd3YXRjaCcpXG4gICAgICAgICAgICAub3B0aW9uKCdjb25maWcnLCB7XG4gICAgICAgICAgICAgICAgYWJicjogJ2MnLFxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBERUZBVUxUX0NPTkZJR19OQU1FKSxcbiAgICAgICAgICAgICAgICBoZWxwOiAncGF0aCB0byBCbGl0eiBjb25maWcnLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5vcHRpb24oJ2J1aWxkJywge1xuICAgICAgICAgICAgICAgIGFiYnI6ICdiJyxcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgREVGQVVMVF9CVUlMRF9ESVJFQ1RPUllfTkFNRSksXG4gICAgICAgICAgICAgICAgaGVscDogJ3BhdGggdG8gdGFyZ2V0IGJ1aWxkIGRpcmVjdG9yeScsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmhlbHAoJ3dhdGNoZXMgc291cmNlIGNvZGUgYW5kIHJlYnVpbGRzIHRoZSB3ZWJzaXRlIHdoZW4gbmVjZXNzYXJ5JylcbiAgICAgICAgICAgIC5jYWxsYmFjaygob3B0cykgPT4gQmxpdHoud2F0Y2gob3B0cy5jb25maWcsIG9wdHMuYnVpbGQpKTtcbiAgICAgICAgcGFyc2VyLmNvbW1hbmQoJ3ByZXZpZXcnKVxuICAgICAgICAgICAgLmhlbHAoJ3N0YXJ0cyBhIHdlYiBzZXJ2ZXIgZm9yIHJlYWwtdGltZSBjaGFuZ2UgcHJldmlldycpXG4gICAgICAgICAgICAuY2FsbGJhY2soKCkgPT4gQmxpdHoucHJldmlldygpKTtcblxuICAgICAgICBsZXQgbm9ybWFsaXNlZEFyZ3YgPSBhcmd2LnNsaWNlKDIpO1xuICAgICAgICBhcmdzID0gcGFyc2VyLnBhcnNlKG5vcm1hbGlzZWRBcmd2KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmludHMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHZlcnNpb25cbiAgICAgKiBAc2luY2UgMC4yLjBcbiAgICAgKi9cbiAgICBwdWJsaWMgc3RhdGljIHZlcnNpb24oKSB7XG4gICAgICAgIGxldCB2ZXJib3NlU3RhdGUgPSBnbG9iYWwudmVyYm9zZTtcbiAgICAgICAgZ2xvYmFsLnZlcmJvc2UgPSB0cnVlO1xuICAgICAgICBMb2dnZXIubG9nKCdCbGl0eiB2JyArIFV0aWwuZ2V0UGFja2FnZUluZm8oKS52ZXJzaW9uICsgJywgdXNlIGAnICsgTG9nZ2VyLmJyYW5kKCdibGl0eiAtaCcpICsgJ2AgZm9yIGhlbHAnKTtcbiAgICAgICAgTG9nZ2VyLmxvZygnRm9yIGRvY3VtZW50YXRpb24sIHJlZmVyIHRvICcgKyBMb2dnZXIuYnJhbmQoJ2h0dHBzOi8vZ2V0YmxpdHouaW8vJykpO1xuICAgICAgICBnbG9iYWwudmVyYm9zZSA9IHZlcmJvc2VTdGF0ZTtcbiAgICB9XG59XG4iXX0=
